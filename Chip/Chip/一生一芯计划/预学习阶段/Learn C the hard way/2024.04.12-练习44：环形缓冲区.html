<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>2024.04.12-练习44：环形缓冲区 | Personal Blog --from Outis Li</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/Blog/assets/css/0.styles.9501ef99.css" as="style"><link rel="preload" href="/Blog/assets/js/app.fffc62c2.js" as="script"><link rel="preload" href="/Blog/assets/js/2.d9b38520.js" as="script"><link rel="preload" href="/Blog/assets/js/1.a4e52cf6.js" as="script"><link rel="preload" href="/Blog/assets/js/48.9fa80ad1.js" as="script"><link rel="prefetch" href="/Blog/assets/js/10.c8b6361b.js"><link rel="prefetch" href="/Blog/assets/js/100.31d8a184.js"><link rel="prefetch" href="/Blog/assets/js/101.43f73921.js"><link rel="prefetch" href="/Blog/assets/js/102.5ed282f0.js"><link rel="prefetch" href="/Blog/assets/js/103.38126020.js"><link rel="prefetch" href="/Blog/assets/js/104.18a97c2e.js"><link rel="prefetch" href="/Blog/assets/js/105.0e28206e.js"><link rel="prefetch" href="/Blog/assets/js/106.72dc4a51.js"><link rel="prefetch" href="/Blog/assets/js/107.4f8bc33d.js"><link rel="prefetch" href="/Blog/assets/js/108.9a2b3df8.js"><link rel="prefetch" href="/Blog/assets/js/109.acce4c89.js"><link rel="prefetch" href="/Blog/assets/js/11.1a662648.js"><link rel="prefetch" href="/Blog/assets/js/110.9c843418.js"><link rel="prefetch" href="/Blog/assets/js/111.5588d5e5.js"><link rel="prefetch" href="/Blog/assets/js/112.e2a0c013.js"><link rel="prefetch" href="/Blog/assets/js/113.1d702661.js"><link rel="prefetch" href="/Blog/assets/js/114.ea11a3c7.js"><link rel="prefetch" href="/Blog/assets/js/115.07cb358a.js"><link rel="prefetch" href="/Blog/assets/js/12.eccfbbbe.js"><link rel="prefetch" href="/Blog/assets/js/13.931bd67a.js"><link rel="prefetch" href="/Blog/assets/js/14.2bf74249.js"><link rel="prefetch" href="/Blog/assets/js/15.339e7fa7.js"><link rel="prefetch" href="/Blog/assets/js/16.198e4ae3.js"><link rel="prefetch" href="/Blog/assets/js/17.8071f72f.js"><link rel="prefetch" href="/Blog/assets/js/18.3d9ea382.js"><link rel="prefetch" href="/Blog/assets/js/19.831e14a0.js"><link rel="prefetch" href="/Blog/assets/js/20.9b49ec2d.js"><link rel="prefetch" href="/Blog/assets/js/21.1ec03a46.js"><link rel="prefetch" href="/Blog/assets/js/22.a17f69b5.js"><link rel="prefetch" href="/Blog/assets/js/23.883f4d72.js"><link rel="prefetch" href="/Blog/assets/js/24.288d26b1.js"><link rel="prefetch" href="/Blog/assets/js/25.8382691f.js"><link rel="prefetch" href="/Blog/assets/js/26.b16a0955.js"><link rel="prefetch" href="/Blog/assets/js/27.48df2183.js"><link rel="prefetch" href="/Blog/assets/js/28.78a93a22.js"><link rel="prefetch" href="/Blog/assets/js/29.35173b18.js"><link rel="prefetch" href="/Blog/assets/js/3.2e411533.js"><link rel="prefetch" href="/Blog/assets/js/30.399eb7e0.js"><link rel="prefetch" href="/Blog/assets/js/31.b3883f92.js"><link rel="prefetch" href="/Blog/assets/js/32.41cbba68.js"><link rel="prefetch" href="/Blog/assets/js/33.8c7dad02.js"><link rel="prefetch" href="/Blog/assets/js/34.14dbba3c.js"><link rel="prefetch" href="/Blog/assets/js/35.4f3f9027.js"><link rel="prefetch" href="/Blog/assets/js/36.fb0febbe.js"><link rel="prefetch" href="/Blog/assets/js/37.4389234d.js"><link rel="prefetch" href="/Blog/assets/js/38.8ed5cb63.js"><link rel="prefetch" href="/Blog/assets/js/39.737bc7aa.js"><link rel="prefetch" href="/Blog/assets/js/4.fb4fd8cb.js"><link rel="prefetch" href="/Blog/assets/js/40.a8f08a39.js"><link rel="prefetch" href="/Blog/assets/js/41.9bf43c30.js"><link rel="prefetch" href="/Blog/assets/js/42.a0c00c32.js"><link rel="prefetch" href="/Blog/assets/js/43.a0c5e0dc.js"><link rel="prefetch" href="/Blog/assets/js/44.5c5a7720.js"><link rel="prefetch" href="/Blog/assets/js/45.5cf2d723.js"><link rel="prefetch" href="/Blog/assets/js/46.9bf39433.js"><link rel="prefetch" href="/Blog/assets/js/47.3160d2d2.js"><link rel="prefetch" href="/Blog/assets/js/49.936e67cd.js"><link rel="prefetch" href="/Blog/assets/js/5.936fe44f.js"><link rel="prefetch" href="/Blog/assets/js/50.4697b95b.js"><link rel="prefetch" href="/Blog/assets/js/51.ac66a436.js"><link rel="prefetch" href="/Blog/assets/js/52.d4c332c8.js"><link rel="prefetch" href="/Blog/assets/js/53.c9523c0d.js"><link rel="prefetch" href="/Blog/assets/js/54.1eaf6097.js"><link rel="prefetch" href="/Blog/assets/js/55.0890672b.js"><link rel="prefetch" href="/Blog/assets/js/56.05a29d48.js"><link rel="prefetch" href="/Blog/assets/js/57.33d78bd1.js"><link rel="prefetch" href="/Blog/assets/js/58.b459354c.js"><link rel="prefetch" href="/Blog/assets/js/59.9c73fddf.js"><link rel="prefetch" href="/Blog/assets/js/6.78a547ee.js"><link rel="prefetch" href="/Blog/assets/js/60.7299e19c.js"><link rel="prefetch" href="/Blog/assets/js/61.14b5149d.js"><link rel="prefetch" href="/Blog/assets/js/62.9d7660e9.js"><link rel="prefetch" href="/Blog/assets/js/63.5d1e8d84.js"><link rel="prefetch" href="/Blog/assets/js/64.0a735136.js"><link rel="prefetch" href="/Blog/assets/js/65.d8b81a24.js"><link rel="prefetch" href="/Blog/assets/js/66.cae6262d.js"><link rel="prefetch" href="/Blog/assets/js/67.2e380607.js"><link rel="prefetch" href="/Blog/assets/js/68.60ad3ba4.js"><link rel="prefetch" href="/Blog/assets/js/69.02f55698.js"><link rel="prefetch" href="/Blog/assets/js/7.21716967.js"><link rel="prefetch" href="/Blog/assets/js/70.194f0590.js"><link rel="prefetch" href="/Blog/assets/js/71.ee7d9bfb.js"><link rel="prefetch" href="/Blog/assets/js/72.43af9dd4.js"><link rel="prefetch" href="/Blog/assets/js/73.973c695f.js"><link rel="prefetch" href="/Blog/assets/js/74.c2b70d6c.js"><link rel="prefetch" href="/Blog/assets/js/75.a359e09d.js"><link rel="prefetch" href="/Blog/assets/js/76.c39b2efa.js"><link rel="prefetch" href="/Blog/assets/js/77.a5f949cf.js"><link rel="prefetch" href="/Blog/assets/js/78.6bd57e21.js"><link rel="prefetch" href="/Blog/assets/js/79.7cd9d8f4.js"><link rel="prefetch" href="/Blog/assets/js/80.a67aaeeb.js"><link rel="prefetch" href="/Blog/assets/js/81.828cb38e.js"><link rel="prefetch" href="/Blog/assets/js/82.37554809.js"><link rel="prefetch" href="/Blog/assets/js/83.0064504d.js"><link rel="prefetch" href="/Blog/assets/js/84.dd48bb56.js"><link rel="prefetch" href="/Blog/assets/js/85.f2cafb4b.js"><link rel="prefetch" href="/Blog/assets/js/86.f670b220.js"><link rel="prefetch" href="/Blog/assets/js/87.46382599.js"><link rel="prefetch" href="/Blog/assets/js/88.c3f9ed96.js"><link rel="prefetch" href="/Blog/assets/js/89.f2e32b85.js"><link rel="prefetch" href="/Blog/assets/js/90.3b1cd03d.js"><link rel="prefetch" href="/Blog/assets/js/91.6a37ce11.js"><link rel="prefetch" href="/Blog/assets/js/92.6ba751dd.js"><link rel="prefetch" href="/Blog/assets/js/93.036c2667.js"><link rel="prefetch" href="/Blog/assets/js/94.5e1af68e.js"><link rel="prefetch" href="/Blog/assets/js/95.7faaf930.js"><link rel="prefetch" href="/Blog/assets/js/96.d8b18168.js"><link rel="prefetch" href="/Blog/assets/js/97.4e7ad107.js"><link rel="prefetch" href="/Blog/assets/js/98.b741819f.js"><link rel="prefetch" href="/Blog/assets/js/99.c01eca41.js"><link rel="prefetch" href="/Blog/assets/js/vendors~docsearch.3b28fe31.js">
    <link rel="stylesheet" href="/Blog/assets/css/0.styles.9501ef99.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Blog/" class="home-link router-link-active"><img src="/Blog/assets/img/good.png" alt="Personal Blog --from Outis Li" class="logo"> <span class="site-name can-hide">Personal Blog --from Outis Li</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Research" class="dropdown-title"><span class="title">Research</span> <span class="arrow down"></span></button> <button type="button" aria-label="Research" class="mobile-dropdown-title"><span class="title">Research</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blog/Research/Research/2023-Geant4.html" class="nav-link">
  Geant4
</a></li><li class="dropdown-item"><h4>
          CS
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/Research/Research/2023.12.12-Docker.html" class="nav-link">
  Docker
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/2. 2024.02.21-Chisel.html" class="nav-link">
  tbc
</a></li></ul></li><li class="dropdown-item"><h4>
          tbc
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/3. 2023.11.07-Verilog语法.html" class="nav-link">
  tbc
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/3. 2023.11.07-Verilog语法.html" class="nav-link">
  tbc
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="LeetCode" class="dropdown-title"><span class="title">LeetCode</span> <span class="arrow down"></span></button> <button type="button" aria-label="LeetCode" class="mobile-dropdown-title"><span class="title">LeetCode</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Basic
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/LeetCode/Leetcode/2024.02.22-BFS.html" class="nav-link">
  BFS
</a></li><li class="dropdown-subitem"><a href="/Blog/LeetCode/Leetcode/2024.03.05-二叉树.html" class="nav-link">
  二叉树
</a></li><li class="dropdown-subitem"><a href="/Blog/LeetCode/Leetcode/2024.03.11-二分搜索.html" class="nav-link">
  二分搜索
</a></li><li class="dropdown-subitem"><a href="/Blog/LeetCode/Leetcode/2024.03.18-滑动窗口.html" class="nav-link">
  滑动窗口
</a></li></ul></li><li class="dropdown-item"><h4>
          tbc
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/3. 2023.11.07-Verilog语法.html" class="nav-link">
  tbc
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/3. 2023.11.07-Verilog语法.html" class="nav-link">
  tbc
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Chip" class="dropdown-title"><span class="title">Chip</span> <span class="arrow down"></span></button> <button type="button" aria-label="Chip" class="mobile-dropdown-title"><span class="title">Chip</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          一生一芯
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/1. 一生一芯计划.html" class="nav-link">
  预学习
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/1. 一生一芯计划.html" class="nav-link">
  B阶段
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/1. 一生一芯计划.html" class="nav-link">
  A阶段
</a></li></ul></li><li class="dropdown-item"><h4>
          Chisel
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/2. 2024.02.21-Chisel.html" class="nav-link">
  Outline
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/2024.02.21-Chisel/2024.02.21-ChiselBoot.html" class="nav-link">
  Bootcamp
</a></li></ul></li><li class="dropdown-item"><h4>
          Verilog
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/3. 2023.11.07-Verilog语法.html" class="nav-link">
  Outline
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/3. 2023.11.07-Verilog语法.html" class="nav-link">
  Basic
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Others" class="dropdown-title"><span class="title">Others</span> <span class="arrow down"></span></button> <button type="button" aria-label="Others" class="mobile-dropdown-title"><span class="title">Others</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          tbc
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/1. 一生一芯计划.html" class="nav-link">
  tbc
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/1. 一生一芯计划.html" class="nav-link">
  tbc
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/1. 一生一芯计划.html" class="nav-link">
  tbc
</a></li></ul></li><li class="dropdown-item"><h4>
          tbc
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/2024.02.21-Chisel/2024.02.21-ChiselBoot.html" class="nav-link">
  tbc
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/2. 2024.02.21-Chisel.html" class="nav-link">
  tbc
</a></li></ul></li><li class="dropdown-item"><h4>
          tbc
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/3. 2023.11.07-Verilog语法.html" class="nav-link">
  tbc
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/3. 2023.11.07-Verilog语法.html" class="nav-link">
  tbc
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Research" class="dropdown-title"><span class="title">Research</span> <span class="arrow down"></span></button> <button type="button" aria-label="Research" class="mobile-dropdown-title"><span class="title">Research</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blog/Research/Research/2023-Geant4.html" class="nav-link">
  Geant4
</a></li><li class="dropdown-item"><h4>
          CS
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/Research/Research/2023.12.12-Docker.html" class="nav-link">
  Docker
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/2. 2024.02.21-Chisel.html" class="nav-link">
  tbc
</a></li></ul></li><li class="dropdown-item"><h4>
          tbc
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/3. 2023.11.07-Verilog语法.html" class="nav-link">
  tbc
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/3. 2023.11.07-Verilog语法.html" class="nav-link">
  tbc
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="LeetCode" class="dropdown-title"><span class="title">LeetCode</span> <span class="arrow down"></span></button> <button type="button" aria-label="LeetCode" class="mobile-dropdown-title"><span class="title">LeetCode</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Basic
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/LeetCode/Leetcode/2024.02.22-BFS.html" class="nav-link">
  BFS
</a></li><li class="dropdown-subitem"><a href="/Blog/LeetCode/Leetcode/2024.03.05-二叉树.html" class="nav-link">
  二叉树
</a></li><li class="dropdown-subitem"><a href="/Blog/LeetCode/Leetcode/2024.03.11-二分搜索.html" class="nav-link">
  二分搜索
</a></li><li class="dropdown-subitem"><a href="/Blog/LeetCode/Leetcode/2024.03.18-滑动窗口.html" class="nav-link">
  滑动窗口
</a></li></ul></li><li class="dropdown-item"><h4>
          tbc
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/3. 2023.11.07-Verilog语法.html" class="nav-link">
  tbc
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/3. 2023.11.07-Verilog语法.html" class="nav-link">
  tbc
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Chip" class="dropdown-title"><span class="title">Chip</span> <span class="arrow down"></span></button> <button type="button" aria-label="Chip" class="mobile-dropdown-title"><span class="title">Chip</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          一生一芯
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/1. 一生一芯计划.html" class="nav-link">
  预学习
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/1. 一生一芯计划.html" class="nav-link">
  B阶段
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/1. 一生一芯计划.html" class="nav-link">
  A阶段
</a></li></ul></li><li class="dropdown-item"><h4>
          Chisel
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/2. 2024.02.21-Chisel.html" class="nav-link">
  Outline
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/2024.02.21-Chisel/2024.02.21-ChiselBoot.html" class="nav-link">
  Bootcamp
</a></li></ul></li><li class="dropdown-item"><h4>
          Verilog
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/3. 2023.11.07-Verilog语法.html" class="nav-link">
  Outline
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/3. 2023.11.07-Verilog语法.html" class="nav-link">
  Basic
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Others" class="dropdown-title"><span class="title">Others</span> <span class="arrow down"></span></button> <button type="button" aria-label="Others" class="mobile-dropdown-title"><span class="title">Others</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          tbc
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/1. 一生一芯计划.html" class="nav-link">
  tbc
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/1. 一生一芯计划.html" class="nav-link">
  tbc
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/1. 一生一芯计划.html" class="nav-link">
  tbc
</a></li></ul></li><li class="dropdown-item"><h4>
          tbc
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/2024.02.21-Chisel/2024.02.21-ChiselBoot.html" class="nav-link">
  tbc
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/2. 2024.02.21-Chisel.html" class="nav-link">
  tbc
</a></li></ul></li><li class="dropdown-item"><h4>
          tbc
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/3. 2023.11.07-Verilog语法.html" class="nav-link">
  tbc
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/3. 2023.11.07-Verilog语法.html" class="nav-link">
  tbc
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Learn C The Hard Way</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.02-练习1：启用编译器.html" class="sidebar-link">2024.04.02-练习 1：启用编译器</a></li><li><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.02-练习2：用Make来代替Python.html" class="sidebar-link">2024.04.02-练习 2：用 Make 来代替 Python</a></li><li><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.02-练习3：格式化输出.html" class="sidebar-link">2024.04.02-练习3：格式化输出</a></li><li><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.03-练习4：Valgrind 介绍.html" class="sidebar-link">2024.04.03-练习4：Valgrind 介绍</a></li><li><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.03-练习5：一个C程序的结构.html" class="sidebar-link">2024.04.03-练习5：一个C程序的结构</a></li><li><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.03-练习6：变量类型.html" class="sidebar-link">2024.04.03-练习6：变量类型</a></li><li><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.03-练习7：更多变量和一些算术.html" class="sidebar-link">2024.04.03-练习7：更多变量和一些算术</a></li><li><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.03-练习8：大小和数组.html" class="sidebar-link">2024.04.03-练习8：大小和数组</a></li><li><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.03-练习9：数组和字符串.html" class="sidebar-link">2024.04.03-练习9：数组和字符串</a></li><li><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.04-练习10：字符串数组和循环.html" class="sidebar-link">2024.04.04-练习10：字符串数组和循环</a></li><li><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.05-练习11：While循环和布尔表达式.html" class="sidebar-link">2024.04.05-练习11：While循环和布尔表达式</a></li><li><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.05-练习12：If，Else If，Else.html" class="sidebar-link">2024.04.05-练习12：If，Else If，Else</a></li><li><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.05-练习13：Switch语句.html" class="sidebar-link">2024.04.05-练习13：Switch语句</a></li><li><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.05-练习14：编写并使用函数.html" class="sidebar-link">2024.04.05-练习14：编写并使用函数</a></li><li><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.05-练习15：指针，可怕的指针.html" class="sidebar-link">2024.04.05-练习15：指针，可怕的指针</a></li><li><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.05-练习16：结构体和指向它们的指针.html" class="sidebar-link">2024.04.05-练习16：结构体和指向它们的指针</a></li><li><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.08-练习17：堆和栈的内存分配.html" class="sidebar-link">2024.04.08-练习17：堆和栈的内存分配</a></li><li><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.10-练习18：函数指针.html" class="sidebar-link">2024.04.10-练习18：函数指针</a></li><li><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.10-练习32：双向链表.html" class="sidebar-link">2024.04.10-练习32：双向链表</a></li><li><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.11-练习33：链表算法.html" class="sidebar-link">2024.04.11-练习33：链表算法</a></li><li><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.11-练习42：栈和队列.html" class="sidebar-link">2024.04.11-练习42：栈和队列</a></li><li><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.12-练习44：环形缓冲区.html" class="active sidebar-link">2024.04.12-练习44：环形缓冲区</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.12-练习44：环形缓冲区.html#_1-头文件" class="sidebar-link">1. 头文件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.12-练习44：环形缓冲区.html#头文件和宏定义" class="sidebar-link">头文件和宏定义</a></li><li class="sidebar-sub-header"><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.12-练习44：环形缓冲区.html#结构体定义" class="sidebar-link">结构体定义</a></li><li class="sidebar-sub-header"><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.12-练习44：环形缓冲区.html#函数原型" class="sidebar-link">函数原型</a></li><li class="sidebar-sub-header"><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.12-练习44：环形缓冲区.html#宏定义" class="sidebar-link">宏定义</a></li><li class="sidebar-sub-header"><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.12-练习44：环形缓冲区.html#提交数据的宏" class="sidebar-link">提交数据的宏</a></li></ul></li><li class="sidebar-sub-header"><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.12-练习44：环形缓冲区.html#_2-源文件" class="sidebar-link">2. 源文件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.12-练习44：环形缓冲区.html#ringbuffer-write函数签名" class="sidebar-link">RingBuffer_write函数签名</a></li><li class="sidebar-sub-header"><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.12-练习44：环形缓冲区.html#函数体" class="sidebar-link">函数体</a></li><li class="sidebar-sub-header"><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.12-练习44：环形缓冲区.html#确定起始位置" class="sidebar-link">确定起始位置</a></li><li class="sidebar-sub-header"><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.12-练习44：环形缓冲区.html#检查是否有足够空间" class="sidebar-link">检查是否有足够空间</a></li><li class="sidebar-sub-header"><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.12-练习44：环形缓冲区.html#数据复制" class="sidebar-link">数据复制</a></li><li class="sidebar-sub-header"><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.12-练习44：环形缓冲区.html#提交写操作" class="sidebar-link">提交写操作</a></li><li class="sidebar-sub-header"><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.12-练习44：环形缓冲区.html#成功返回" class="sidebar-link">成功返回</a></li><li class="sidebar-sub-header"><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.12-练习44：环形缓冲区.html#错误处理" class="sidebar-link">错误处理</a></li><li class="sidebar-sub-header"><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.12-练习44：环形缓冲区.html#ringbuffer-write总结" class="sidebar-link">RingBuffer_write总结</a></li><li class="sidebar-sub-header"><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.12-练习44：环形缓冲区.html#ringbuffer-read" class="sidebar-link">RingBuffer_read</a></li><li class="sidebar-sub-header"><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.12-练习44：环形缓冲区.html#ringbuffer-gets" class="sidebar-link">RingBuffer_gets</a></li><li class="sidebar-sub-header"><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.12-练习44：环形缓冲区.html#主要区别" class="sidebar-link">主要区别</a></li></ul></li><li class="sidebar-sub-header"><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.12-练习44：环形缓冲区.html#_3-测试" class="sidebar-link">3. 测试</a></li><li class="sidebar-sub-header"><a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.12-练习44：环形缓冲区.html#_4-一些修改" class="sidebar-link">4. 一些修改</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_2024-04-12-练习44-环形缓冲区"><a href="#_2024-04-12-练习44-环形缓冲区" class="header-anchor">#</a> 2024.04.12-练习44：环形缓冲区</h1> <h2 id="_1-头文件"><a href="#_1-头文件" class="header-anchor">#</a> 1. 头文件</h2> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">_lcthw_RingBuffer_h</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_lcthw_RingBuffer_h</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;lcthw/bstrlib.h&gt;</span></span>

<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>buffer<span class="token punctuation">;</span>
    <span class="token keyword">int</span> length<span class="token punctuation">;</span>
    <span class="token keyword">int</span> start<span class="token punctuation">;</span>
    <span class="token keyword">int</span> end<span class="token punctuation">;</span>
<span class="token punctuation">}</span> RingBuffer<span class="token punctuation">;</span>

RingBuffer <span class="token operator">*</span><span class="token function">RingBuffer_create</span><span class="token punctuation">(</span><span class="token keyword">int</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">RingBuffer_destroy</span><span class="token punctuation">(</span>RingBuffer <span class="token operator">*</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">RingBuffer_read</span><span class="token punctuation">(</span>RingBuffer <span class="token operator">*</span>buffer<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>target<span class="token punctuation">,</span> <span class="token keyword">int</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">RingBuffer_write</span><span class="token punctuation">(</span>RingBuffer <span class="token operator">*</span>buffer<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>data<span class="token punctuation">,</span> <span class="token keyword">int</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">RingBuffer_empty</span><span class="token punctuation">(</span>RingBuffer <span class="token operator">*</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">RingBuffer_full</span><span class="token punctuation">(</span>RingBuffer <span class="token operator">*</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">RingBuffer_available_data</span><span class="token punctuation">(</span>RingBuffer <span class="token operator">*</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">RingBuffer_available_space</span><span class="token punctuation">(</span>RingBuffer <span class="token operator">*</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

bstring <span class="token function">RingBuffer_gets</span><span class="token punctuation">(</span>RingBuffer <span class="token operator">*</span>buffer<span class="token punctuation">,</span> <span class="token keyword">int</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">RingBuffer_available_data</span><span class="token expression"><span class="token punctuation">(</span>B<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token operator">-&gt;</span>end <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token operator">-&gt;</span>length <span class="token operator">-</span> <span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token operator">-&gt;</span>start <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">RingBuffer_available_space</span><span class="token expression"><span class="token punctuation">(</span>B<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token operator">-&gt;</span>length <span class="token operator">-</span> <span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token operator">-&gt;</span>end <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">RingBuffer_full</span><span class="token expression"><span class="token punctuation">(</span>B<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token function">RingBuffer_available_data</span><span class="token punctuation">(</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token operator">-&gt;</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">RingBuffer_empty</span><span class="token expression"><span class="token punctuation">(</span>B<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token function">RingBuffer_available_data</span><span class="token punctuation">(</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">RingBuffer_puts</span><span class="token expression"><span class="token punctuation">(</span>B<span class="token punctuation">,</span> D<span class="token punctuation">)</span> <span class="token function">RingBuffer_write</span><span class="token punctuation">(</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">bdata</span><span class="token punctuation">(</span><span class="token punctuation">(</span>D<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">blength</span><span class="token punctuation">(</span><span class="token punctuation">(</span>D<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">RingBuffer_get_all</span><span class="token expression"><span class="token punctuation">(</span>B<span class="token punctuation">)</span> <span class="token function">RingBuffer_gets</span><span class="token punctuation">(</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">RingBuffer_available_data</span><span class="token punctuation">(</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">RingBuffer_starts_at</span><span class="token expression"><span class="token punctuation">(</span>B<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token operator">-&gt;</span>buffer <span class="token operator">+</span> <span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token operator">-&gt;</span>start<span class="token punctuation">)</span></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">RingBuffer_ends_at</span><span class="token expression"><span class="token punctuation">(</span>B<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token operator">-&gt;</span>buffer <span class="token operator">+</span> <span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token operator">-&gt;</span>end<span class="token punctuation">)</span></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">RingBuffer_commit_read</span><span class="token expression"><span class="token punctuation">(</span>B<span class="token punctuation">,</span> A<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token operator">-&gt;</span>start <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token operator">-&gt;</span>start <span class="token operator">+</span> <span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token operator">-&gt;</span>length<span class="token punctuation">)</span></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">RingBuffer_commit_write</span><span class="token expression"><span class="token punctuation">(</span>B<span class="token punctuation">,</span> A<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token operator">-&gt;</span>end <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token operator">-&gt;</span>end <span class="token operator">+</span> <span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token operator">-&gt;</span>length<span class="token punctuation">)</span></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre></div><p>这段代码定义了一个环形缓冲区（Ring Buffer），它是一种数据结构，用于在有限的缓冲区空间中高效地处理数据流。这种结构非常适合于需要循环利用空间的场景，比如网络通信或文件流处理。以下是代码中各部分的详细解释：</p> <h3 id="头文件和宏定义"><a href="#头文件和宏定义" class="header-anchor">#</a> 头文件和宏定义</h3> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">_lcthw_RingBuffer_h</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_lcthw_RingBuffer_h</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;lcthw/bstrlib.h&gt;</span></span>
</code></pre></div><p>这部分代码使用预处理命令来防止头文件被重复包含。<code>#include &lt;lcthw/bstrlib.h&gt;</code>是引入一个字符串库，这个库可能提供了一些额外的字符串处理功能。</p> <h3 id="结构体定义"><a href="#结构体定义" class="header-anchor">#</a> 结构体定义</h3> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>buffer<span class="token punctuation">;</span>
    <span class="token keyword">int</span> length<span class="token punctuation">;</span>
    <span class="token keyword">int</span> start<span class="token punctuation">;</span>
    <span class="token keyword">int</span> end<span class="token punctuation">;</span>
<span class="token punctuation">}</span> RingBuffer<span class="token punctuation">;</span>
</code></pre></div><p>这是环形缓冲区的基础结构，包含了以下字段：</p> <ul><li><code>char *buffer</code>：指向实际存储数据的内存区域。</li> <li><code>int length</code>：缓冲区的总长度。</li> <li><code>int start</code>：指示数据开始的位置。</li> <li><code>int end</code>：指示数据结束的位置。</li></ul> <h3 id="函数原型"><a href="#函数原型" class="header-anchor">#</a> 函数原型</h3> <p>环形缓冲区的操作包括创建、销毁、读取、写入以及检查缓冲区的状态：</p> <ul><li><code>RingBuffer_create(int length)</code>：创建一个指定长度的环形缓冲区。</li> <li><code>RingBuffer_destroy(RingBuffer *buffer)</code>：销毁缓冲区，释放资源。</li> <li><code>RingBuffer_read(RingBuffer *buffer, char *target, int amount)</code>：从缓冲区读取数据到<code>target</code>数组。</li> <li><code>RingBuffer_write(RingBuffer *buffer, char *data, int length)</code>：将数据写入缓冲区。</li> <li><code>bstring RingBuffer_gets(RingBuffer *buffer, int amount)</code>：读取指定数量的数据为一个<code>bstring</code>。</li></ul> <h3 id="宏定义"><a href="#宏定义" class="header-anchor">#</a> 宏定义</h3> <p>这些宏定义提供了一种快速访问缓冲区状态的方式，比如检查缓冲区是否空或满：</p> <ul><li><code>RingBuffer_available_data(B)</code>：计算缓冲区中已存储的数据量。</li> <li><code>RingBuffer_available_space(B)</code>：计算缓冲区中剩余的空间量。</li> <li><code>RingBuffer_full(B)</code>：检查缓冲区是否已满。</li> <li><code>RingBuffer_empty(B)</code>：检查缓冲区是否为空。</li> <li><code>RingBuffer_puts(B, D)</code>：便捷函数，用于将<code>bstring</code>类型的数据写入缓冲区。</li> <li><code>RingBuffer_get_all(B)</code>：获取缓冲区中的所有数据。</li></ul> <h3 id="提交数据的宏"><a href="#提交数据的宏" class="header-anchor">#</a> 提交数据的宏</h3> <ul><li><code>RingBuffer_commit_read(B, A)</code>：在读取操作后更新<code>start</code>位置。</li> <li><code>RingBuffer_commit_write(B, A)</code>：在写入操作后更新<code>end</code>位置。</li></ul> <h2 id="_2-源文件"><a href="#_2-源文件" class="header-anchor">#</a> 2. 源文件</h2> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">undef</span> <span class="token expression">NDEBUG</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;assert.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;lcthw/dbg.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;lcthw/ringbuffer.h&gt;</span></span>

RingBuffer <span class="token operator">*</span><span class="token function">RingBuffer_create</span><span class="token punctuation">(</span><span class="token keyword">int</span> length<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    RingBuffer <span class="token operator">*</span>buffer <span class="token operator">=</span> <span class="token function">calloc</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>RingBuffer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    buffer<span class="token operator">-&gt;</span>length  <span class="token operator">=</span> length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    buffer<span class="token operator">-&gt;</span>start <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    buffer<span class="token operator">-&gt;</span>end <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    buffer<span class="token operator">-&gt;</span>buffer <span class="token operator">=</span> <span class="token function">calloc</span><span class="token punctuation">(</span>buffer<span class="token operator">-&gt;</span>length<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> buffer<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">RingBuffer_destroy</span><span class="token punctuation">(</span>RingBuffer <span class="token operator">*</span>buffer<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">free</span><span class="token punctuation">(</span>buffer<span class="token operator">-&gt;</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">free</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">RingBuffer_write</span><span class="token punctuation">(</span>RingBuffer <span class="token operator">*</span>buffer<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>data<span class="token punctuation">,</span> <span class="token keyword">int</span> length<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">RingBuffer_available_data</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        buffer<span class="token operator">-&gt;</span>start <span class="token operator">=</span> buffer<span class="token operator">-&gt;</span>end <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">check</span><span class="token punctuation">(</span>length <span class="token operator">&lt;=</span> <span class="token function">RingBuffer_available_space</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">&quot;Not enough space: %d request, %d available&quot;</span><span class="token punctuation">,</span>
            <span class="token function">RingBuffer_available_data</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token operator">*</span>result <span class="token operator">=</span> <span class="token function">memcpy</span><span class="token punctuation">(</span><span class="token function">RingBuffer_ends_at</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">,</span> data<span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">check</span><span class="token punctuation">(</span>result <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token string">&quot;Failed to write data into buffer.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">RingBuffer_commit_write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> length<span class="token punctuation">;</span>
error<span class="token operator">:</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">RingBuffer_read</span><span class="token punctuation">(</span>RingBuffer <span class="token operator">*</span>buffer<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>target<span class="token punctuation">,</span> <span class="token keyword">int</span> amount<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">check_debug</span><span class="token punctuation">(</span>amount <span class="token operator">&lt;=</span> <span class="token function">RingBuffer_available_data</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">&quot;Not enough in the buffer: has %d, needs %d&quot;</span><span class="token punctuation">,</span>
            <span class="token function">RingBuffer_available_data</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token operator">*</span>result <span class="token operator">=</span> <span class="token function">memcpy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token function">RingBuffer_starts_at</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">check</span><span class="token punctuation">(</span>result <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token string">&quot;Failed to write buffer into data.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">RingBuffer_commit_read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>buffer<span class="token operator">-&gt;</span>end <span class="token operator">==</span> buffer<span class="token operator">-&gt;</span>start<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        buffer<span class="token operator">-&gt;</span>start <span class="token operator">=</span> buffer<span class="token operator">-&gt;</span>end <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> amount<span class="token punctuation">;</span>
error<span class="token operator">:</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

bstring <span class="token function">RingBuffer_gets</span><span class="token punctuation">(</span>RingBuffer <span class="token operator">*</span>buffer<span class="token punctuation">,</span> <span class="token keyword">int</span> amount<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">check</span><span class="token punctuation">(</span>amount <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;Need more than 0 for gets, you gave: %d &quot;</span><span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">check_debug</span><span class="token punctuation">(</span>amount <span class="token operator">&lt;=</span> <span class="token function">RingBuffer_available_data</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">&quot;Not enough in the buffer.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    bstring result <span class="token operator">=</span> <span class="token function">blk2bstr</span><span class="token punctuation">(</span><span class="token function">RingBuffer_starts_at</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">check</span><span class="token punctuation">(</span>result <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token string">&quot;Failed to create gets result.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">check</span><span class="token punctuation">(</span><span class="token function">blength</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">==</span> amount<span class="token punctuation">,</span> <span class="token string">&quot;Wrong result length.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">RingBuffer_commit_read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assert</span><span class="token punctuation">(</span><span class="token function">RingBuffer_available_data</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token string">&quot;Error in read commit.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
error<span class="token operator">:</span>
    <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这个 <code>RingBuffer_write</code> 函数是一个环形缓冲区的写操作函数，其作用是将数据从一个指定的源（<code>data</code> 参数）写入到环形缓冲区中。这段代码涉及错误检查、内存复制以及更新缓冲区指针的操作。下面我将逐步解析这个函数的每一部分。</p> <h3 id="ringbuffer-write函数签名"><a href="#ringbuffer-write函数签名" class="header-anchor">#</a> <code>RingBuffer_write</code>函数签名</h3> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">RingBuffer_write</span><span class="token punctuation">(</span>RingBuffer <span class="token operator">*</span>buffer<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>data<span class="token punctuation">,</span> <span class="token keyword">int</span> length<span class="token punctuation">)</span>
</code></pre></div><p>这个函数接收三个参数：</p> <ul><li><code>buffer</code>：指向 <code>RingBuffer</code> 类型的指针，代表目标环形缓冲区。</li> <li><code>data</code>：指向需要写入缓冲区的数据的指针。</li> <li><code>length</code>：指定要写入的数据长度。</li></ul> <p>函数返回写入的字节数，如果出现错误，则返回 <code>-1</code>。</p> <h3 id="函数体"><a href="#函数体" class="header-anchor">#</a> 函数体</h3> <h3 id="确定起始位置"><a href="#确定起始位置" class="header-anchor">#</a> 确定起始位置</h3> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">RingBuffer_available_data</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    buffer<span class="token operator">-&gt;</span>start <span class="token operator">=</span> buffer<span class="token operator">-&gt;</span>end <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这里检查缓冲区是否为空（没有数据）。如果是空的，将 <code>start</code> 和 <code>end</code> 指针都重置为 <code>0</code>。这种重置是为了优化写入性能，确保从缓冲区的开始位置写入数据。</p> <h3 id="检查是否有足够空间"><a href="#检查是否有足够空间" class="header-anchor">#</a> 检查是否有足够空间</h3> <div class="language-c extra-class"><pre class="language-c"><code><span class="token function">check</span><span class="token punctuation">(</span>length <span class="token operator">&lt;=</span> <span class="token function">RingBuffer_available_space</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token string">&quot;Not enough space: %d request, %d available&quot;</span><span class="token punctuation">,</span>
      <span class="token function">RingBuffer_available_data</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>使用 <code>check</code> 宏（这通常是一个错误处理宏）来确保要写入的数据长度不会超过缓冲区的可用空间。如果超出可用空间，则打印错误信息并跳转到错误处理代码（<code>error:</code> 标签）。</p> <h3 id="数据复制"><a href="#数据复制" class="header-anchor">#</a> 数据复制</h3> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token operator">*</span>result <span class="token operator">=</span> <span class="token function">memcpy</span><span class="token punctuation">(</span><span class="token function">RingBuffer_ends_at</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">,</span> data<span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">check</span><span class="token punctuation">(</span>result <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token string">&quot;Failed to write data into buffer.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>通过 <code>memcpy</code> 函数将数据从 <code>data</code> 指针复制到缓冲区中由 <code>RingBuffer_ends_at(buffer)</code> 返回的位置。<code>memcpy</code> 应该总是返回其目的地址，除非发生异常。这里的检查是为了确保数据确实被写入了。</p> <h3 id="提交写操作"><a href="#提交写操作" class="header-anchor">#</a> 提交写操作</h3> <div class="language-c extra-class"><pre class="language-c"><code><span class="token function">RingBuffer_commit_write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>更新缓冲区的 <code>end</code> 指针，以反映新写入的数据量。这通过 <code>RingBuffer_commit_write</code> 宏实现，它会适当地调整 <code>end</code> 指针，包括处理可能的环形回绕。</p> <h3 id="成功返回"><a href="#成功返回" class="header-anchor">#</a> 成功返回</h3> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">return</span> length<span class="token punctuation">;</span>
</code></pre></div><p>如果一切正常，函数返回写入的字节数。</p> <h3 id="错误处理"><a href="#错误处理" class="header-anchor">#</a> 错误处理</h3> <div class="language-c extra-class"><pre class="language-c"><code>error<span class="token operator">:</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
</code></pre></div><p>如果在检查或写操作中遇到任何问题，函数跳转到这里并返回 <code>-1</code>，表示发生了错误。</p> <h3 id="ringbuffer-write总结"><a href="#ringbuffer-write总结" class="header-anchor">#</a> <code>RingBuffer_write</code>总结</h3> <p><code>RingBuffer_write</code> 是一个典型的环形缓冲区数据写入函数，它涵盖了错误处理、空间检查、数据复制和指针更新等关键操作。这种实现保证了数据的安全写入，并且能有效地利用缓冲区的空间。通过适当的指针和边界管理，环形缓冲区可以在有限的内存空间内循环使用，非常适用于如 I/O 数据流处理等场景。</p> <p><code>RingBuffer_read</code> 和 <code>RingBuffer_gets</code> 都是环形缓冲区中用于从缓冲区读取数据的函数，但它们在处理数据的方式和返回类型上有所不同。这两个函数各有其特定的用途和行为，下面详细解释这两者之间的区别：</p> <h3 id="ringbuffer-read"><a href="#ringbuffer-read" class="header-anchor">#</a> <code>RingBuffer_read</code></h3> <ul><li><strong>功能</strong>：将数据从环形缓冲区复制到另一个缓冲区（通常是一个字符数组）。</li> <li><strong>参数</strong>：
<ul><li><code>buffer</code>：指向 <code>RingBuffer</code> 结构的指针。</li> <li><code>target</code>：目标缓冲区，用于接收从环形缓冲区复制的数据。</li> <li><code>amount</code>：要从环形缓冲区读取的数据字节数。</li></ul></li> <li><strong>行为</strong>：
<ul><li>使用 <code>memcpy</code> 从 <code>RingBuffer_starts_at(buffer)</code> 的位置开始，将 <code>amount</code> 字节的数据复制到 <code>target</code> 中。</li> <li>读取操作完成后，通过 <code>RingBuffer_commit_read</code> 更新 <code>start</code> 指针。</li> <li>如果 <code>start</code> 和 <code>end</code> 指针相等，表示缓冲区变为空，将它们重置为0。</li></ul></li> <li><strong>返回值</strong>：成功时返回读取的字节数，失败时返回 <code>1</code>。</li></ul> <h3 id="ringbuffer-gets"><a href="#ringbuffer-gets" class="header-anchor">#</a> <code>RingBuffer_gets</code></h3> <ul><li><strong>功能</strong>：从环形缓冲区获取一定数量的数据，并返回一个 <code>bstring</code> 对象。</li> <li><strong>参数</strong>：
<ul><li><code>buffer</code>：指向 <code>RingBuffer</code> 结构的指针。</li> <li><code>amount</code>：要从环形缓冲区读取的数据字节数。</li></ul></li> <li><strong>行为</strong>：
<ul><li>使用 <code>blk2bstr</code> 从环形缓冲区的 <code>start</code> 位置创建一个新的 <code>bstring</code> 对象，其中包含 <code>amount</code> 字节的数据。</li> <li>类似于 <code>RingBuffer_read</code>，读取操作后通过 <code>RingBuffer_commit_read</code> 更新 <code>start</code> 指针。</li> <li>检查返回的 <code>bstring</code> 的长度是否正确，并确保没有数据处理错误。</li></ul></li> <li><strong>返回值</strong>：成功时返回一个 <code>bstring</code> 对象，失败时返回 <code>NULL</code>。</li></ul> <h3 id="主要区别"><a href="#主要区别" class="header-anchor">#</a> 主要区别</h3> <ol><li><strong>返回类型</strong>：
<ul><li><code>RingBuffer_read</code> 返回一个整数（读取的字节数），并将数据直接写入提供的目标缓冲区。</li> <li><code>RingBuffer_gets</code> 返回一个 <code>bstring</code> 对象，这是一个封装了数据和长度的结构体，用于更方便的字符串处理。</li></ul></li> <li><strong>数据处理方式</strong>：
<ul><li><code>RingBuffer_read</code> 直接操作原始字节数据。</li> <li><code>RingBuffer_gets</code> 则可能更适用于处理文本数据，因为它提供了一种易于管理和操作的字符串形式。</li></ul></li> <li><strong>错误处理和安全性</strong>：
<ul><li><code>RingBuffer_gets</code> 在创建 <code>bstring</code> 时进行了额外的检查，如长度验证和空值检查，这可以提供更高的数据完整性保证。</li></ul></li> <li><strong>使用场景</strong>：
<ul><li><code>RingBuffer_read</code> 更多地用于需要直接处理字节数据的场景，如文件读写、网络数据传输等。</li> <li><code>RingBuffer_gets</code> 适用于需要字符串操作的场景，比如解析文本命令或读取配置文件等。</li></ul></li></ol> <p>总之，选择 <code>RingBuffer_read</code> 还是 <code>RingBuffer_gets</code> 取决于你的应用场景和对数据类型的需求。如果你需要直接处理原始数据，<code>RingBuffer_read</code> 是合适的；如果你需要处理和存储字符串数据，并可能在之后进行进一步的字符串操作，<code>RingBuffer_gets</code> 会是更好的选择。</p> <h2 id="_3-测试"><a href="#_3-测试" class="header-anchor">#</a> 3. 测试</h2> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;minunit.h&quot;</span>    <span class="token comment">// 引入MinUnit头文件</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;RingBuffer.h&quot;</span> <span class="token comment">// 引入环形缓冲区的实现</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;assert.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">NUM_TESTS</span> <span class="token expression"><span class="token number">5</span></span></span>
<span class="token keyword">static</span> RingBuffer <span class="token operator">*</span>rb <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

<span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">test_create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    rb <span class="token operator">=</span> <span class="token function">RingBuffer_create</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">mu_assert</span><span class="token punctuation">(</span>rb <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token string">&quot;Failed to create RingBuffer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">mu_assert</span><span class="token punctuation">(</span>rb<span class="token operator">-&gt;</span>length <span class="token operator">==</span> <span class="token number">1025</span><span class="token punctuation">,</span> <span class="token string">&quot;RingBuffer length incorrect&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">mu_assert</span><span class="token punctuation">(</span><span class="token function">RingBuffer_empty</span><span class="token punctuation">(</span>rb<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;RingBuffer should be empty after creation&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">test_write_read</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>data <span class="token operator">=</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token function">RingBuffer_write</span><span class="token punctuation">(</span>rb<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">mu_assert</span><span class="token punctuation">(</span>result <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&quot;RingBuffer_write should write 4 bytes&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">char</span> output<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 确保有足够的空间和零初始化</span>
    result <span class="token operator">=</span> <span class="token function">RingBuffer_read</span><span class="token punctuation">(</span>rb<span class="token punctuation">,</span> output<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">mu_assert</span><span class="token punctuation">(</span>result <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&quot;RingBuffer_read should read 4 bytes&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">mu_assert</span><span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>output<span class="token punctuation">,</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;RingBuffer_read did not read the correct data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">test_puts_get_all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    bstring data <span class="token operator">=</span> <span class="token function">bfromcstr</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">RingBuffer_puts</span><span class="token punctuation">(</span>rb<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    bstring result <span class="token operator">=</span> <span class="token function">RingBuffer_get_all</span><span class="token punctuation">(</span>rb<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">mu_assert</span><span class="token punctuation">(</span><span class="token function">biseq</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;RingBuffer_get_all did not return the correct data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">bdestroy</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">bdestroy</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">test_puts_gets</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    bstring data <span class="token operator">=</span> <span class="token function">bfromcstr</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">RingBuffer_puts</span><span class="token punctuation">(</span>rb<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    bstring result <span class="token operator">=</span> <span class="token function">RingBuffer_gets</span><span class="token punctuation">(</span>rb<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">mu_assert</span><span class="token punctuation">(</span><span class="token function">biseq</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;RingBuffer_gets did not return the correct data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">bdestroy</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">bdestroy</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">test_destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">mu_assert</span><span class="token punctuation">(</span>rb <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token string">&quot;Failed to create RingBuffer#2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">RingBuffer_destroy</span><span class="token punctuation">(</span>rb<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">static</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">all_tests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">mu_suite_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 初始化测试套件</span>
    <span class="token function">mu_run_test</span><span class="token punctuation">(</span>test_create<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">mu_run_test</span><span class="token punctuation">(</span>test_write_read<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">mu_run_test</span><span class="token punctuation">(</span>test_puts_get_all<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">mu_run_test</span><span class="token punctuation">(</span>test_puts_gets<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">mu_run_test</span><span class="token punctuation">(</span>test_destroy<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用RUN_TESTS宏运行所有测试</span>
<span class="token function">RUN_TESTS</span><span class="token punctuation">(</span>all_tests<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="/Blog/assets/img/440.73503d7b.png" alt="Untitled"></p> <h2 id="_4-一些修改"><a href="#_4-一些修改" class="header-anchor">#</a> 4. 一些修改</h2> <div class="language-c extra-class"><pre class="language-c"><code><span class="token comment">//#define RingBuffer_available_data(B) (((B)-&gt;end + 1) % (B)-&gt;length - (B)-&gt;start - 1)</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">RingBuffer_available_data</span><span class="token expression"><span class="token punctuation">(</span>B<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token operator">-&gt;</span>end <span class="token operator">&gt;=</span> <span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token operator">-&gt;</span>start<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token operator">-&gt;</span>end <span class="token operator">-</span> <span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token operator">-&gt;</span>start<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token operator">-&gt;</span>length <span class="token operator">-</span> <span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token operator">-&gt;</span>start <span class="token operator">+</span> <span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token operator">-&gt;</span>end<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>

<span class="token comment">//#define RingBuffer_available_space(B) ((B)-&gt;length - (B)-&gt;end - 1)</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">RingBuffer_available_space</span><span class="token expression"><span class="token punctuation">(</span>B<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token operator">-&gt;</span>length <span class="token operator">-</span> <span class="token function">RingBuffer_available_data</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span>

<span class="token comment">//#define RingBuffer_full(B) (RingBuffer_available_data((B)) - (B)-&gt;length == 0)</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">RingBuffer_full</span><span class="token expression"><span class="token punctuation">(</span>B<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token function">RingBuffer_available_space</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span></span></span>
</code></pre></div><p>原来的宏并没有判断end与start的前后位置。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Blog/Chip/Chip/一生一芯计划/预学习阶段/Learn C the hard way/2024.04.11-练习42：栈和队列.html" class="prev">
        2024.04.11-练习42：栈和队列
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/Blog/assets/js/app.fffc62c2.js" defer></script><script src="/Blog/assets/js/2.d9b38520.js" defer></script><script src="/Blog/assets/js/1.a4e52cf6.js" defer></script><script src="/Blog/assets/js/48.9fa80ad1.js" defer></script>
  </body>
</html>
