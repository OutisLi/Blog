<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>2024.03.03-3.2 Generators: Collections | Personal Blog --from Outis Li</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/Blog/assets/css/0.styles.9501ef99.css" as="style"><link rel="preload" href="/Blog/assets/js/app.fffc62c2.js" as="script"><link rel="preload" href="/Blog/assets/js/2.d9b38520.js" as="script"><link rel="preload" href="/Blog/assets/js/1.a4e52cf6.js" as="script"><link rel="preload" href="/Blog/assets/js/62.9d7660e9.js" as="script"><link rel="prefetch" href="/Blog/assets/js/10.c8b6361b.js"><link rel="prefetch" href="/Blog/assets/js/100.31d8a184.js"><link rel="prefetch" href="/Blog/assets/js/101.43f73921.js"><link rel="prefetch" href="/Blog/assets/js/102.5ed282f0.js"><link rel="prefetch" href="/Blog/assets/js/103.38126020.js"><link rel="prefetch" href="/Blog/assets/js/104.18a97c2e.js"><link rel="prefetch" href="/Blog/assets/js/105.0e28206e.js"><link rel="prefetch" href="/Blog/assets/js/106.72dc4a51.js"><link rel="prefetch" href="/Blog/assets/js/107.4f8bc33d.js"><link rel="prefetch" href="/Blog/assets/js/108.9a2b3df8.js"><link rel="prefetch" href="/Blog/assets/js/109.acce4c89.js"><link rel="prefetch" href="/Blog/assets/js/11.1a662648.js"><link rel="prefetch" href="/Blog/assets/js/110.9c843418.js"><link rel="prefetch" href="/Blog/assets/js/111.5588d5e5.js"><link rel="prefetch" href="/Blog/assets/js/112.e2a0c013.js"><link rel="prefetch" href="/Blog/assets/js/113.1d702661.js"><link rel="prefetch" href="/Blog/assets/js/114.ea11a3c7.js"><link rel="prefetch" href="/Blog/assets/js/115.07cb358a.js"><link rel="prefetch" href="/Blog/assets/js/12.eccfbbbe.js"><link rel="prefetch" href="/Blog/assets/js/13.931bd67a.js"><link rel="prefetch" href="/Blog/assets/js/14.2bf74249.js"><link rel="prefetch" href="/Blog/assets/js/15.339e7fa7.js"><link rel="prefetch" href="/Blog/assets/js/16.198e4ae3.js"><link rel="prefetch" href="/Blog/assets/js/17.8071f72f.js"><link rel="prefetch" href="/Blog/assets/js/18.3d9ea382.js"><link rel="prefetch" href="/Blog/assets/js/19.831e14a0.js"><link rel="prefetch" href="/Blog/assets/js/20.9b49ec2d.js"><link rel="prefetch" href="/Blog/assets/js/21.1ec03a46.js"><link rel="prefetch" href="/Blog/assets/js/22.a17f69b5.js"><link rel="prefetch" href="/Blog/assets/js/23.883f4d72.js"><link rel="prefetch" href="/Blog/assets/js/24.288d26b1.js"><link rel="prefetch" href="/Blog/assets/js/25.8382691f.js"><link rel="prefetch" href="/Blog/assets/js/26.b16a0955.js"><link rel="prefetch" href="/Blog/assets/js/27.48df2183.js"><link rel="prefetch" href="/Blog/assets/js/28.78a93a22.js"><link rel="prefetch" href="/Blog/assets/js/29.35173b18.js"><link rel="prefetch" href="/Blog/assets/js/3.2e411533.js"><link rel="prefetch" href="/Blog/assets/js/30.399eb7e0.js"><link rel="prefetch" href="/Blog/assets/js/31.b3883f92.js"><link rel="prefetch" href="/Blog/assets/js/32.41cbba68.js"><link rel="prefetch" href="/Blog/assets/js/33.8c7dad02.js"><link rel="prefetch" href="/Blog/assets/js/34.14dbba3c.js"><link rel="prefetch" href="/Blog/assets/js/35.4f3f9027.js"><link rel="prefetch" href="/Blog/assets/js/36.fb0febbe.js"><link rel="prefetch" href="/Blog/assets/js/37.4389234d.js"><link rel="prefetch" href="/Blog/assets/js/38.8ed5cb63.js"><link rel="prefetch" href="/Blog/assets/js/39.737bc7aa.js"><link rel="prefetch" href="/Blog/assets/js/4.fb4fd8cb.js"><link rel="prefetch" href="/Blog/assets/js/40.a8f08a39.js"><link rel="prefetch" href="/Blog/assets/js/41.9bf43c30.js"><link rel="prefetch" href="/Blog/assets/js/42.a0c00c32.js"><link rel="prefetch" href="/Blog/assets/js/43.a0c5e0dc.js"><link rel="prefetch" href="/Blog/assets/js/44.5c5a7720.js"><link rel="prefetch" href="/Blog/assets/js/45.5cf2d723.js"><link rel="prefetch" href="/Blog/assets/js/46.9bf39433.js"><link rel="prefetch" href="/Blog/assets/js/47.3160d2d2.js"><link rel="prefetch" href="/Blog/assets/js/48.9fa80ad1.js"><link rel="prefetch" href="/Blog/assets/js/49.936e67cd.js"><link rel="prefetch" href="/Blog/assets/js/5.936fe44f.js"><link rel="prefetch" href="/Blog/assets/js/50.4697b95b.js"><link rel="prefetch" href="/Blog/assets/js/51.ac66a436.js"><link rel="prefetch" href="/Blog/assets/js/52.d4c332c8.js"><link rel="prefetch" href="/Blog/assets/js/53.c9523c0d.js"><link rel="prefetch" href="/Blog/assets/js/54.1eaf6097.js"><link rel="prefetch" href="/Blog/assets/js/55.0890672b.js"><link rel="prefetch" href="/Blog/assets/js/56.05a29d48.js"><link rel="prefetch" href="/Blog/assets/js/57.33d78bd1.js"><link rel="prefetch" href="/Blog/assets/js/58.b459354c.js"><link rel="prefetch" href="/Blog/assets/js/59.9c73fddf.js"><link rel="prefetch" href="/Blog/assets/js/6.78a547ee.js"><link rel="prefetch" href="/Blog/assets/js/60.7299e19c.js"><link rel="prefetch" href="/Blog/assets/js/61.14b5149d.js"><link rel="prefetch" href="/Blog/assets/js/63.5d1e8d84.js"><link rel="prefetch" href="/Blog/assets/js/64.0a735136.js"><link rel="prefetch" href="/Blog/assets/js/65.d8b81a24.js"><link rel="prefetch" href="/Blog/assets/js/66.cae6262d.js"><link rel="prefetch" href="/Blog/assets/js/67.2e380607.js"><link rel="prefetch" href="/Blog/assets/js/68.60ad3ba4.js"><link rel="prefetch" href="/Blog/assets/js/69.02f55698.js"><link rel="prefetch" href="/Blog/assets/js/7.21716967.js"><link rel="prefetch" href="/Blog/assets/js/70.194f0590.js"><link rel="prefetch" href="/Blog/assets/js/71.ee7d9bfb.js"><link rel="prefetch" href="/Blog/assets/js/72.43af9dd4.js"><link rel="prefetch" href="/Blog/assets/js/73.973c695f.js"><link rel="prefetch" href="/Blog/assets/js/74.c2b70d6c.js"><link rel="prefetch" href="/Blog/assets/js/75.a359e09d.js"><link rel="prefetch" href="/Blog/assets/js/76.c39b2efa.js"><link rel="prefetch" href="/Blog/assets/js/77.a5f949cf.js"><link rel="prefetch" href="/Blog/assets/js/78.6bd57e21.js"><link rel="prefetch" href="/Blog/assets/js/79.7cd9d8f4.js"><link rel="prefetch" href="/Blog/assets/js/80.a67aaeeb.js"><link rel="prefetch" href="/Blog/assets/js/81.828cb38e.js"><link rel="prefetch" href="/Blog/assets/js/82.37554809.js"><link rel="prefetch" href="/Blog/assets/js/83.0064504d.js"><link rel="prefetch" href="/Blog/assets/js/84.dd48bb56.js"><link rel="prefetch" href="/Blog/assets/js/85.f2cafb4b.js"><link rel="prefetch" href="/Blog/assets/js/86.f670b220.js"><link rel="prefetch" href="/Blog/assets/js/87.46382599.js"><link rel="prefetch" href="/Blog/assets/js/88.c3f9ed96.js"><link rel="prefetch" href="/Blog/assets/js/89.f2e32b85.js"><link rel="prefetch" href="/Blog/assets/js/90.3b1cd03d.js"><link rel="prefetch" href="/Blog/assets/js/91.6a37ce11.js"><link rel="prefetch" href="/Blog/assets/js/92.6ba751dd.js"><link rel="prefetch" href="/Blog/assets/js/93.036c2667.js"><link rel="prefetch" href="/Blog/assets/js/94.5e1af68e.js"><link rel="prefetch" href="/Blog/assets/js/95.7faaf930.js"><link rel="prefetch" href="/Blog/assets/js/96.d8b18168.js"><link rel="prefetch" href="/Blog/assets/js/97.4e7ad107.js"><link rel="prefetch" href="/Blog/assets/js/98.b741819f.js"><link rel="prefetch" href="/Blog/assets/js/99.c01eca41.js"><link rel="prefetch" href="/Blog/assets/js/vendors~docsearch.3b28fe31.js">
    <link rel="stylesheet" href="/Blog/assets/css/0.styles.9501ef99.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Blog/" class="home-link router-link-active"><img src="/Blog/assets/img/good.png" alt="Personal Blog --from Outis Li" class="logo"> <span class="site-name can-hide">Personal Blog --from Outis Li</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Research" class="dropdown-title"><span class="title">Research</span> <span class="arrow down"></span></button> <button type="button" aria-label="Research" class="mobile-dropdown-title"><span class="title">Research</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blog/Research/Research/2023-Geant4.html" class="nav-link">
  Geant4
</a></li><li class="dropdown-item"><h4>
          CS
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/Research/Research/2023.12.12-Docker.html" class="nav-link">
  Docker
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/2. 2024.02.21-Chisel.html" class="nav-link">
  tbc
</a></li></ul></li><li class="dropdown-item"><h4>
          tbc
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/3. 2023.11.07-Verilog语法.html" class="nav-link">
  tbc
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/3. 2023.11.07-Verilog语法.html" class="nav-link">
  tbc
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="LeetCode" class="dropdown-title"><span class="title">LeetCode</span> <span class="arrow down"></span></button> <button type="button" aria-label="LeetCode" class="mobile-dropdown-title"><span class="title">LeetCode</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Basic
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/LeetCode/Leetcode/2024.02.22-BFS.html" class="nav-link">
  BFS
</a></li><li class="dropdown-subitem"><a href="/Blog/LeetCode/Leetcode/2024.03.05-二叉树.html" class="nav-link">
  二叉树
</a></li><li class="dropdown-subitem"><a href="/Blog/LeetCode/Leetcode/2024.03.11-二分搜索.html" class="nav-link">
  二分搜索
</a></li><li class="dropdown-subitem"><a href="/Blog/LeetCode/Leetcode/2024.03.18-滑动窗口.html" class="nav-link">
  滑动窗口
</a></li></ul></li><li class="dropdown-item"><h4>
          tbc
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/3. 2023.11.07-Verilog语法.html" class="nav-link">
  tbc
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/3. 2023.11.07-Verilog语法.html" class="nav-link">
  tbc
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Chip" class="dropdown-title"><span class="title">Chip</span> <span class="arrow down"></span></button> <button type="button" aria-label="Chip" class="mobile-dropdown-title"><span class="title">Chip</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          一生一芯
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/1. 一生一芯计划.html" class="nav-link">
  预学习
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/1. 一生一芯计划.html" class="nav-link">
  B阶段
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/1. 一生一芯计划.html" class="nav-link">
  A阶段
</a></li></ul></li><li class="dropdown-item"><h4>
          Chisel
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/2. 2024.02.21-Chisel.html" class="nav-link">
  Outline
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/2024.02.21-Chisel/2024.02.21-ChiselBoot.html" class="nav-link">
  Bootcamp
</a></li></ul></li><li class="dropdown-item"><h4>
          Verilog
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/3. 2023.11.07-Verilog语法.html" class="nav-link">
  Outline
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/3. 2023.11.07-Verilog语法.html" class="nav-link">
  Basic
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Others" class="dropdown-title"><span class="title">Others</span> <span class="arrow down"></span></button> <button type="button" aria-label="Others" class="mobile-dropdown-title"><span class="title">Others</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          tbc
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/1. 一生一芯计划.html" class="nav-link">
  tbc
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/1. 一生一芯计划.html" class="nav-link">
  tbc
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/1. 一生一芯计划.html" class="nav-link">
  tbc
</a></li></ul></li><li class="dropdown-item"><h4>
          tbc
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/2024.02.21-Chisel/2024.02.21-ChiselBoot.html" class="nav-link">
  tbc
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/2. 2024.02.21-Chisel.html" class="nav-link">
  tbc
</a></li></ul></li><li class="dropdown-item"><h4>
          tbc
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/3. 2023.11.07-Verilog语法.html" class="nav-link">
  tbc
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/3. 2023.11.07-Verilog语法.html" class="nav-link">
  tbc
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Research" class="dropdown-title"><span class="title">Research</span> <span class="arrow down"></span></button> <button type="button" aria-label="Research" class="mobile-dropdown-title"><span class="title">Research</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blog/Research/Research/2023-Geant4.html" class="nav-link">
  Geant4
</a></li><li class="dropdown-item"><h4>
          CS
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/Research/Research/2023.12.12-Docker.html" class="nav-link">
  Docker
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/2. 2024.02.21-Chisel.html" class="nav-link">
  tbc
</a></li></ul></li><li class="dropdown-item"><h4>
          tbc
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/3. 2023.11.07-Verilog语法.html" class="nav-link">
  tbc
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/3. 2023.11.07-Verilog语法.html" class="nav-link">
  tbc
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="LeetCode" class="dropdown-title"><span class="title">LeetCode</span> <span class="arrow down"></span></button> <button type="button" aria-label="LeetCode" class="mobile-dropdown-title"><span class="title">LeetCode</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Basic
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/LeetCode/Leetcode/2024.02.22-BFS.html" class="nav-link">
  BFS
</a></li><li class="dropdown-subitem"><a href="/Blog/LeetCode/Leetcode/2024.03.05-二叉树.html" class="nav-link">
  二叉树
</a></li><li class="dropdown-subitem"><a href="/Blog/LeetCode/Leetcode/2024.03.11-二分搜索.html" class="nav-link">
  二分搜索
</a></li><li class="dropdown-subitem"><a href="/Blog/LeetCode/Leetcode/2024.03.18-滑动窗口.html" class="nav-link">
  滑动窗口
</a></li></ul></li><li class="dropdown-item"><h4>
          tbc
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/3. 2023.11.07-Verilog语法.html" class="nav-link">
  tbc
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/3. 2023.11.07-Verilog语法.html" class="nav-link">
  tbc
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Chip" class="dropdown-title"><span class="title">Chip</span> <span class="arrow down"></span></button> <button type="button" aria-label="Chip" class="mobile-dropdown-title"><span class="title">Chip</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          一生一芯
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/1. 一生一芯计划.html" class="nav-link">
  预学习
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/1. 一生一芯计划.html" class="nav-link">
  B阶段
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/1. 一生一芯计划.html" class="nav-link">
  A阶段
</a></li></ul></li><li class="dropdown-item"><h4>
          Chisel
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/2. 2024.02.21-Chisel.html" class="nav-link">
  Outline
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/2024.02.21-Chisel/2024.02.21-ChiselBoot.html" class="nav-link">
  Bootcamp
</a></li></ul></li><li class="dropdown-item"><h4>
          Verilog
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/3. 2023.11.07-Verilog语法.html" class="nav-link">
  Outline
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/3. 2023.11.07-Verilog语法.html" class="nav-link">
  Basic
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Others" class="dropdown-title"><span class="title">Others</span> <span class="arrow down"></span></button> <button type="button" aria-label="Others" class="mobile-dropdown-title"><span class="title">Others</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          tbc
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/1. 一生一芯计划.html" class="nav-link">
  tbc
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/1. 一生一芯计划.html" class="nav-link">
  tbc
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/1. 一生一芯计划.html" class="nav-link">
  tbc
</a></li></ul></li><li class="dropdown-item"><h4>
          tbc
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/2024.02.21-Chisel/2024.02.21-ChiselBoot.html" class="nav-link">
  tbc
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/2. 2024.02.21-Chisel.html" class="nav-link">
  tbc
</a></li></ul></li><li class="dropdown-item"><h4>
          tbc
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/3. 2023.11.07-Verilog语法.html" class="nav-link">
  tbc
</a></li><li class="dropdown-subitem"><a href="/Blog/Chip/Chip/3. 2023.11.07-Verilog语法.html" class="nav-link">
  tbc
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>2024 02 21 Chisel Boot</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Blog/Chip/Chip/2024.02.21-Chisel/2024.02.21-ChiselBoot/2024.02.21-1 Introduction to Scala.html" class="sidebar-link">2024.02.21-1. Introduction to Scala</a></li><li><a href="/Blog/Chip/Chip/2024.02.21-Chisel/2024.02.21-ChiselBoot/2024.02.23-2.1 First Chisel Module.html" class="sidebar-link">2024.02.23-2.1 First Chisel Module</a></li><li><a href="/Blog/Chip/Chip/2024.02.21-Chisel/2024.02.21-ChiselBoot/2024.02.24-2.2 Combinational Logic.html" class="sidebar-link">2024.02.24-2.2 Combinational Logic</a></li><li><a href="/Blog/Chip/Chip/2024.02.21-Chisel/2024.02.21-ChiselBoot/2024.02.25-2.3 Control Flow.html" class="sidebar-link">2024.02.25-2.3 Control Flow</a></li><li><a href="/Blog/Chip/Chip/2024.02.21-Chisel/2024.02.21-ChiselBoot/2024.02.26-2.4 Sequential Logic.html" class="sidebar-link">2024.02.26-2.4 Sequential Logic</a></li><li><a href="/Blog/Chip/Chip/2024.02.21-Chisel/2024.02.21-ChiselBoot/2024.02.28-2.5 FIR Filter.html" class="sidebar-link">2024.02.28-2.5 FIR Filter</a></li><li><a href="/Blog/Chip/Chip/2024.02.21-Chisel/2024.02.21-ChiselBoot/2024.02.29-2.6 More on ChiselTest.html" class="sidebar-link">2024.02.29-2.6 More on ChiselTest</a></li><li><a href="/Blog/Chip/Chip/2024.02.21-Chisel/2024.02.21-ChiselBoot/2024.03.01-3.1 Generators Parameters.html" class="sidebar-link">2024.03.01-3.1 Generators: Parameters</a></li><li><a href="/Blog/Chip/Chip/2024.02.21-Chisel/2024.02.21-ChiselBoot/2024.03.03-3.2 Generators Collections.html" class="active sidebar-link">2024.03.03-3.2 Generators: Collections</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Blog/Chip/Chip/2024.02.21-Chisel/2024.02.21-ChiselBoot/2024.03.03-3.2 Generators Collections.html#generators-and-collections" class="sidebar-link">Generators and Collections</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Blog/Chip/Chip/2024.02.21-Chisel/2024.02.21-ChiselBoot/2024.03.03-3.2 Generators Collections.html#fir-golden-model" class="sidebar-link">FIR Golden Model</a></li><li class="sidebar-sub-header"><a href="/Blog/Chip/Chip/2024.02.21-Chisel/2024.02.21-ChiselBoot/2024.03.03-3.2 Generators Collections.html#seq" class="sidebar-link">Seq</a></li><li class="sidebar-sub-header"><a href="/Blog/Chip/Chip/2024.02.21-Chisel/2024.02.21-ChiselBoot/2024.03.03-3.2 Generators Collections.html#寄存器" class="sidebar-link">寄存器</a></li><li class="sidebar-sub-header"><a href="/Blog/Chip/Chip/2024.02.21-Chisel/2024.02.21-ChiselBoot/2024.03.03-3.2 Generators Collections.html#poke" class="sidebar-link">Poke</a></li><li class="sidebar-sub-header"><a href="/Blog/Chip/Chip/2024.02.21-Chisel/2024.02.21-ChiselBoot/2024.03.03-3.2 Generators Collections.html#更新寄存器" class="sidebar-link">更新寄存器</a></li><li class="sidebar-sub-header"><a href="/Blog/Chip/Chip/2024.02.21-Chisel/2024.02.21-ChiselBoot/2024.03.03-3.2 Generators Collections.html#计算输出" class="sidebar-link">计算输出</a></li><li class="sidebar-sub-header"><a href="/Blog/Chip/Chip/2024.02.21-Chisel/2024.02.21-ChiselBoot/2024.03.03-3.2 Generators Collections.html#test-circuit-using-the-golden-model" class="sidebar-link">Test circuit using the golden model</a></li><li class="sidebar-sub-header"><a href="/Blog/Chip/Chip/2024.02.21-Chisel/2024.02.21-ChiselBoot/2024.03.03-3.2 Generators Collections.html#example-parameterized-fir-generator" class="sidebar-link">Example: Parameterized FIR Generator</a></li><li class="sidebar-sub-header"><a href="/Blog/Chip/Chip/2024.02.21-Chisel/2024.02.21-ChiselBoot/2024.03.03-3.2 Generators Collections.html#test-a-bunch-of-different-sized-fir-filters" class="sidebar-link">Test a bunch of different sized FIR filters</a></li></ul></li><li class="sidebar-sub-header"><a href="/Blog/Chip/Chip/2024.02.21-Chisel/2024.02.21-ChiselBoot/2024.03.03-3.2 Generators Collections.html#hardware-collections" class="sidebar-link">Hardware Collections</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Blog/Chip/Chip/2024.02.21-Chisel/2024.02.21-ChiselBoot/2024.03.03-3.2 Generators Collections.html#example-add-run-time-configurable-taps-to-our-fir" class="sidebar-link">Example: Add run-time configurable taps to our FIR</a></li><li class="sidebar-sub-header"><a href="/Blog/Chip/Chip/2024.02.21-Chisel/2024.02.21-ChiselBoot/2024.03.03-3.2 Generators Collections.html#example-32-bit-risc-v-processor" class="sidebar-link">Example: 32-bit RISC-V Processor</a></li></ul></li></ul></li><li><a href="/Blog/Chip/Chip/2024.02.21-Chisel/2024.02.21-ChiselBoot/2024.03.04-3.3 Interlude Chisel Standard Library.html" class="sidebar-link">2024.03.04-3.3 Interlude: Chisel Standard Library</a></li><li><a href="/Blog/Chip/Chip/2024.02.21-Chisel/2024.02.21-ChiselBoot/2024.03.05-3.4 Higher-Order Functions.html" class="sidebar-link">2024.03.05-3.4 Higher-Order Functions</a></li><li><a href="/Blog/Chip/Chip/2024.02.21-Chisel/2024.02.21-ChiselBoot/2024.03.07-3.5 Functional Programming.html" class="sidebar-link">2024.03.07-3.5 Functional Programming</a></li><li><a href="/Blog/Chip/Chip/2024.02.21-Chisel/2024.02.21-ChiselBoot/2024.03.09-3.6 Object Oriented Programming.html" class="sidebar-link">2024.03.09-3.6 Object Oriented Programming</a></li><li><a href="/Blog/Chip/Chip/2024.02.21-Chisel/2024.02.21-ChiselBoot/2024.03.12-3.7 Generators Types.html" class="sidebar-link">2024.03.12-3.7 Generators: Types</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_2024-03-03-3-2-generators-collections"><a href="#_2024-03-03-3-2-generators-collections" class="header-anchor">#</a> 2024.03.03-3.2 Generators: Collections</h1> <h2 id="generators-and-collections"><a href="#generators-and-collections" class="header-anchor">#</a> Generators and Collections</h2> <h3 id="fir-golden-model"><a href="#fir-golden-model" class="header-anchor">#</a> FIR Golden Model</h3> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token operator">/</span>
  <span class="token operator">*</span> A naive implementation of an FIR filter <span class="token keyword">with</span> <span class="token namespace">an</span> arbitrary number of taps<span class="token punctuation">.</span>
  <span class="token operator">*</span><span class="token operator">/</span>
<span class="token keyword">class</span> ScalaFirFilter<span class="token punctuation">(</span>taps<span class="token operator">:</span> Seq<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> pseudoRegisters <span class="token operator">=</span> List<span class="token punctuation">.</span>fill<span class="token punctuation">(</span>taps<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

  <span class="token keyword">def</span> poke<span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    pseudoRegisters <span class="token operator">=</span> value <span class="token operator">::</span> pseudoRegisters<span class="token punctuation">.</span>take<span class="token punctuation">(</span>taps<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> accumulator <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token keyword">&lt;-</span> taps<span class="token punctuation">.</span>indices<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      accumulator <span class="token operator">+=</span> taps<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">*</span> pseudoRegisters<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    accumulator
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="seq"><a href="#seq" class="header-anchor">#</a> Seq</h3> <p>当<code>taps</code>变为<code>Seq[Int]</code>时，意味着类的用户可以在构造类时传递任意长度的<code>Int</code>序列。</p> <h3 id="寄存器"><a href="#寄存器" class="header-anchor">#</a> 寄存器</h3> <p>使用<code>var pseudoRegisters = List.fill(taps.length)(0)</code>创建了一个<code>List</code>，用于存储前几个周期的值。选择<code>List</code>是因为其添加元素到头部和移除最后一个元素的语法非常简单。理论上可以使用 Scala 集合家族中的任何成员。这个列表被初始化为全零。</p> <h3 id="poke"><a href="#poke" class="header-anchor">#</a> Poke</h3> <p>我们的类添加了一个 poke 函数/方法，模拟将新输入放入过滤器并循环时钟。</p> <h3 id="更新寄存器"><a href="#更新寄存器" class="header-anchor">#</a> 更新寄存器</h3> <p><code>pseudoRegisters = value :: pseudoRegisters.take(taps.length - 1)</code>首先使用列表的<code>take</code>方法保留除最后一个元素外的所有元素，然后使用<code>::</code>列表连接操作符将<code>value</code>添加到缩减版列表的头部。</p> <h3 id="计算输出"><a href="#计算输出" class="header-anchor">#</a> 计算输出</h3> <p>一个简单的 for 循环和累加器用于求和列表中每个元素与其对应抽头系数的乘积。仅含<code>accumulator</code>的行将该值作为函数结果返回。</p> <h3 id="test-circuit-using-the-golden-model"><a href="#test-circuit-using-the-golden-model" class="header-anchor">#</a> Test circuit using the golden model</h3> <p>为了避免使用繁杂的手动验证，这里使用 Golden Model 来生成期望的值，并与 Chisel 的结果对比</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> goldenModel <span class="token operator">=</span> <span class="token keyword">new</span> ScalaFirFilter<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

test<span class="token punctuation">(</span><span class="token keyword">new</span> My4ElementFir<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> c <span class="token keyword">=&gt;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token keyword">&lt;-</span> <span class="token number">0</span> until <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">val</span> input <span class="token operator">=</span> scala<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Random<span class="token punctuation">.</span>nextInt<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>

        <span class="token keyword">val</span> goldenModelResult <span class="token operator">=</span> goldenModel<span class="token punctuation">.</span>poke<span class="token punctuation">(</span>input<span class="token punctuation">)</span>

        c<span class="token punctuation">.</span>io<span class="token punctuation">.</span>in<span class="token punctuation">.</span>poke<span class="token punctuation">(</span>input<span class="token punctuation">.</span>U<span class="token punctuation">)</span>

        c<span class="token punctuation">.</span>io<span class="token punctuation">.</span>out<span class="token punctuation">.</span>expect<span class="token punctuation">(</span>goldenModelResult<span class="token punctuation">.</span>U<span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token id function">s</span><span class="token string">&quot;i </span><span class="token interpolation"><span class="token punctuation">$</span><span class="token expression">i</span></span><span class="token string">, input </span><span class="token interpolation"><span class="token punctuation">$</span><span class="token expression">input</span></span><span class="token string">, gm </span><span class="token interpolation"><span class="token punctuation">$</span><span class="token expression">goldenModelResult</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">${</span><span class="token expression">c<span class="token punctuation">.</span>io<span class="token punctuation">.</span>out<span class="token punctuation">.</span>peek<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>litValue</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>

        c<span class="token punctuation">.</span>clock<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>注意：这里软件上的 Golden Model 没有考虑位宽，而硬件则与位宽有很大关系。这里只考虑了 8 以内，即 3bit 的数，因此不存在这个问题</p> <h3 id="example-parameterized-fir-generator"><a href="#example-parameterized-fir-generator" class="header-anchor">#</a> Example: Parameterized FIR Generator</h3> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">class</span> MyManyElementFir<span class="token punctuation">(</span>consts<span class="token operator">:</span> Seq<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bitWidth<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token keyword">extends</span> Module <span class="token punctuation">{</span>
  <span class="token keyword">val</span> io <span class="token operator">=</span> IO<span class="token punctuation">(</span><span class="token keyword">new</span> Bundle <span class="token punctuation">{</span>
    <span class="token keyword">val</span> in <span class="token operator">=</span> Input<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span>bitWidth<span class="token punctuation">.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> out <span class="token operator">=</span> Output<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span>bitWidth<span class="token punctuation">.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">val</span> regs <span class="token operator">=</span> mutable<span class="token punctuation">.</span>ArrayBuffer<span class="token punctuation">[</span>UInt<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token keyword">&lt;-</span> <span class="token number">0</span> until consts<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> regs <span class="token operator">+=</span> io<span class="token punctuation">.</span>in
      <span class="token keyword">else</span>       regs <span class="token operator">+=</span> RegNext<span class="token punctuation">(</span>regs<span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.</span>U<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">val</span> muls <span class="token operator">=</span> mutable<span class="token punctuation">.</span>ArrayBuffer<span class="token punctuation">[</span>UInt<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token keyword">&lt;-</span> <span class="token number">0</span> until consts<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      muls <span class="token operator">+=</span> regs<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">*</span> consts<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>U
  <span class="token punctuation">}</span>

  <span class="token keyword">val</span> scan <span class="token operator">=</span> mutable<span class="token punctuation">.</span>ArrayBuffer<span class="token punctuation">[</span>UInt<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token keyword">&lt;-</span> <span class="token number">0</span> until consts<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> scan <span class="token operator">+=</span> muls<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
      <span class="token keyword">else</span> scan <span class="token operator">+=</span> muls<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> scan<span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  io<span class="token punctuation">.</span>out <span class="token operator">:</span><span class="token operator">=</span> scan<span class="token punctuation">.</span>last
<span class="token punctuation">}</span>
</code></pre></div><ol><li><code>val regs = mutable.ArrayBuffer[UInt]()</code>声明了一个名为<code>regs</code>的不可变变量，它被初始化为一个可变的<code>ArrayBuffer</code>，其中包含<code>UInt</code>类型的元素。<code>ArrayBuffer</code>是一个可变的序列，允许在序列两端高效地添加或删除元素，适用于需要动态修改元素的场景。在这里，<code>regs</code>可以被用来存储和更新<code>UInt</code>类型的数据，但由于使用了<code>val</code>，<code>regs</code>本身的引用是不可变的，尽管它指向的<code>ArrayBuffer</code>内容是可变的。</li> <li><code>regs += io.in</code>这行代码的意思是将<code>io.in</code>这个<code>UInt</code>信号添加到<code>regs</code>这个<code>ArrayBuffer</code>中。这里没有直接的数值相加操作，而是将<code>io.in</code>这个元素添加（追加）到<code>regs</code>这个列表的末尾。<code>regs</code>是一个容器，可以逐个添加元素，即使一开始<code>regs</code>是空的。这行代码的作用是初始化<code>regs</code>列表的第一个元素，后续元素则在循环中通过<code>RegNext</code>添加。</li> <li><code>regs</code>作为一个<code>ArrayBuffer</code>，可以包含不同类型的<code>UInt</code>元素。在这种情况下，<code>io.in</code>是一个<code>Input(UInt)</code>类型，而<code>RegNext(regs(i - 1), 0.U)</code>生成的是一个<code>Reg(UInt)</code>类型。尽管<code>io.in</code>和通过<code>RegNext</code>创建的寄存器在硬件层面扮演不同的角色（一个是输入信号，另一个是寄存器），但它们都是<code>UInt</code>类型，可以存储在同一个<code>ArrayBuffer</code>中。在 Chisel 生成的硬件逻辑中，这将创建一个信号和寄存器链，其中信号和寄存器可以互相连接。</li> <li>使用<code>scan</code>数组缓存逐步累加的结果而不是直接对<code>muls</code>求和，是为了展示在每一步如何逐渐累积计算的中间值。这种方法在某些复杂的 FIR 滤波器设计中可以提供更多的灵活性，比如在需要逐个访问累加过程中的中间结果时。尽管在这个特定例子中，只需要最终的累加结果，直接对<code>muls</code>求和看似更直接，但展开累加过程可以帮助理解和调试滤波器的行为，尤其是在更复杂或参数化的设计中。然而，如果目标只是获取最终的累加和，直接使用<code>muls.reduce(_ + _)</code>确实会更简洁高效。</li></ol> <h3 id="test-a-bunch-of-different-sized-fir-filters"><a href="#test-a-bunch-of-different-sized-fir-filters" class="header-anchor">#</a> Test a bunch of different sized FIR filters</h3> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">def</span> r<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  scala<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Random<span class="token punctuation">.</span>nextInt<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token operator">/</span>
  <span class="token operator">*</span> run a test comparing software and hardware filters
  <span class="token operator">*</span> run <span class="token keyword">for</span> at least twice as many samples as taps
  <span class="token operator">*</span><span class="token operator">/</span>
<span class="token keyword">def</span> runOneTest<span class="token punctuation">(</span>taps<span class="token operator">:</span> Seq<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> goldenModel <span class="token operator">=</span> <span class="token keyword">new</span> ScalaFirFilter<span class="token punctuation">(</span>taps<span class="token punctuation">)</span>

    test<span class="token punctuation">(</span><span class="token keyword">new</span> MyManyElementFir<span class="token punctuation">(</span>taps<span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> c <span class="token keyword">=&gt;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token keyword">&lt;-</span> <span class="token number">0</span> until <span class="token number">2</span> <span class="token operator">*</span> taps<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">val</span> input <span class="token operator">=</span> r<span class="token punctuation">(</span><span class="token punctuation">)</span>

            <span class="token keyword">val</span> goldenModelResult <span class="token operator">=</span> goldenModel<span class="token punctuation">.</span>poke<span class="token punctuation">(</span>input<span class="token punctuation">)</span>

            c<span class="token punctuation">.</span>io<span class="token punctuation">.</span>in<span class="token punctuation">.</span>poke<span class="token punctuation">(</span>input<span class="token punctuation">.</span>U<span class="token punctuation">)</span>

            c<span class="token punctuation">.</span>io<span class="token punctuation">.</span>out<span class="token punctuation">.</span>expect<span class="token punctuation">(</span>goldenModelResult<span class="token punctuation">.</span>U<span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token id function">s</span><span class="token string">&quot;i </span><span class="token interpolation"><span class="token punctuation">$</span><span class="token expression">i</span></span><span class="token string">, input </span><span class="token interpolation"><span class="token punctuation">$</span><span class="token expression">input</span></span><span class="token string">, gm </span><span class="token interpolation"><span class="token punctuation">$</span><span class="token expression">goldenModelResult</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">${</span><span class="token expression">c<span class="token punctuation">.</span>io<span class="token punctuation">.</span>out<span class="token punctuation">.</span>peek<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>litValue</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>

            c<span class="token punctuation">.</span>clock<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">for</span><span class="token punctuation">(</span>tapSize <span class="token keyword">&lt;-</span> <span class="token number">2</span> until <span class="token number">100</span> by <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> taps <span class="token operator">=</span> Seq<span class="token punctuation">.</span>fill<span class="token punctuation">(</span>tapSize<span class="token punctuation">)</span><span class="token punctuation">(</span>r<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// create a sequence of random coefficients</span>

    runOneTest<span class="token punctuation">(</span>taps<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ol><li>在 Chisel 测试中，<code>c.clock.step(1)</code>通常放在对输出进行期望检查（<code>expect</code>）之后，因为我们希望在提供输入后推进仿真一个时钟周期，然后在下一个时钟边沿检查输出。这样可以确保寄存器已经更新到了因输入变化而触发的新状态。</li> <li>字符串<code>s&quot;i $i, input $input, gm $goldenModelResult, ${c.io.out.peek().litValue}&quot;</code>是 Scala 的字符串插值，用于构造包含变量值的字符串。这里它构建了一个描述当前测试状态的字符串，包括迭代次数<code>i</code>，当前输入<code>input</code>，金标准模型<code>goldenModel</code>的结果<code>goldenModelResult</code>，以及从待测试模块的输出<code>c.io.out</code>中提取的值。这对于调试和理解测试失败的上下文非常有用。</li></ol> <h2 id="hardware-collections"><a href="#hardware-collections" class="header-anchor">#</a> Hardware Collections</h2> <h3 id="example-add-run-time-configurable-taps-to-our-fir"><a href="#example-add-run-time-configurable-taps-to-our-fir" class="header-anchor">#</a> Example: Add run-time configurable taps to our FIR</h3> <p>在 FIR 生成器的 IO 中添加了一个额外的<code>consts</code>向量，允许在电路生成后从外部改变系数。这是通过 Chisel 集合类型<code>Vec</code>实现的。<code>Vec</code>支持许多 Scala 集合方法，但只能包含 Chisel 硬件元素。仅在普通 Scala 集合无法满足需求的情况下使用<code>Vec</code>，主要是以下两种情况：<em>1.</em> 在 Bundle 中需要元素集合，通常是作为 IO 使用的 Bundle。<em>2.</em> 需要通过硬件部分的索引访问集合（如寄存器文件）。</p> <p>原因在于<code>Vec</code>能够创建一组硬件元素的集合，而这些硬件元素可以在生成的硬件电路中被索引和操作。相反，普通的 Scala 集合，如<code>List</code>或<code>Seq</code>，仅仅在 Scala 软件环境中存在，它们不能直接映射到硬件电路中。因此，当定义硬件模块的 IO 接口或需要在硬件级别按索引访问元素时，应该使用<code>Vec</code>。</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">class</span> MyManyDynamicElementVecFir<span class="token punctuation">(</span>length<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token keyword">extends</span> Module <span class="token punctuation">{</span>
  <span class="token keyword">val</span> io <span class="token operator">=</span> IO<span class="token punctuation">(</span><span class="token keyword">new</span> Bundle <span class="token punctuation">{</span>
    <span class="token keyword">val</span> in <span class="token operator">=</span> Input<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">8.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> out <span class="token operator">=</span> Output<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">8.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> consts <span class="token operator">=</span> Input<span class="token punctuation">(</span>Vec<span class="token punctuation">(</span>length<span class="token punctuation">,</span> UInt<span class="token punctuation">(</span><span class="token number">8.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// Reference solution</span>
  <span class="token keyword">val</span> regs <span class="token operator">=</span> RegInit<span class="token punctuation">(</span>VecInit<span class="token punctuation">(</span>Seq<span class="token punctuation">.</span>fill<span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0.</span>U<span class="token punctuation">(</span><span class="token number">8.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token keyword">&lt;-</span> <span class="token number">0</span> until length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> regs<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">:</span><span class="token operator">=</span> io<span class="token punctuation">.</span>in
      <span class="token keyword">else</span>       regs<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">:</span><span class="token operator">=</span> regs<span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">val</span> muls <span class="token operator">=</span> Wire<span class="token punctuation">(</span>Vec<span class="token punctuation">(</span>length<span class="token punctuation">,</span> UInt<span class="token punctuation">(</span><span class="token number">8.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token keyword">&lt;-</span> <span class="token number">0</span> until length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> muls<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">:</span><span class="token operator">=</span> io<span class="token punctuation">.</span>in <span class="token operator">*</span> io<span class="token punctuation">.</span>consts<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
      <span class="token keyword">else</span>       muls<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">:</span><span class="token operator">=</span> regs<span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> io<span class="token punctuation">.</span>consts<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">val</span> scan <span class="token operator">=</span> Wire<span class="token punctuation">(</span>Vec<span class="token punctuation">(</span>length<span class="token punctuation">,</span> UInt<span class="token punctuation">(</span><span class="token number">8.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token keyword">&lt;-</span> <span class="token number">0</span> until length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> scan<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">:</span><span class="token operator">=</span> muls<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
      <span class="token keyword">else</span> scan<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">:</span><span class="token operator">=</span> muls<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> scan<span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  io<span class="token punctuation">.</span>out <span class="token operator">:</span><span class="token operator">=</span> scan<span class="token punctuation">(</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ol><li><p><code>VecInit</code>用于创建一个<code>Vec</code>，这是 Chisel 中的一种集合类型，专门用于存储硬件元素。<code>Seq.fill(length - 1)(0.U(8.W))</code>生成一个长度为<code>length - 1</code>，每个元素初始化为 8 位宽的 0 的序列。<code>VecInit</code>将这个序列转换成一个<code>Vec</code>，以便在硬件设计中使用。<code>RegInit</code>则将这个<code>Vec</code>初始化为寄存器，使得其值在复位时为指定的初始值。这种方式常用于定义具有多个初始相同值的寄存器数组。</p></li> <li><p><code>Wire(Vec(length, UInt(8.W)))</code> 用于创建一个具有 <code>length</code> 元素的向量，每个元素是 8 位无符号整数。这是在硬件描述语言中创建信号数组的标准方法，允许这些信号在生成的硬件电路中被实例化。</p> <p>相比之下，<code>mutable.ArrayBuffer[UInt]()</code> 是 Scala 的一个集合类型，主要用于软件程序中的数据存储和处理。在 Chisel 的上下文中，你不能直接将 <code>ArrayBuffer</code> 用作硬件信号的容器，因为 <code>ArrayBuffer</code> 是一个可变的、仅在 Scala 软件执行环境中存在的数据结构，它不会被合成到硬件中。</p> <p>简单来说：</p> <ul><li><code>Wire(Vec(length, UInt(8.W)))</code> 在 Chisel 中创建一个硬件向量，这个向量可以在生成的硬件电路中存在并携带信号。</li> <li><code>mutable.ArrayBuffer[UInt]()</code> 创建一个仅在 Scala 软件执行时存在的内存数组，它不能直接用于硬件设计。</li></ul> <p>所以，在你的代码中使用 <code>Wire(Vec(length, UInt(8.W)))</code> 是为了定义一个可以在硬件层面操作和传递信号的向量，这对于硬件设计至关重要。</p> <h3 id="example-32-bit-risc-v-processor"><a href="#example-32-bit-risc-v-processor" class="header-anchor">#</a> Example: 32-bit RISC-V Processor</h3> <p>Register file: An array of registers that can be read from or written to via a number of read or write ports. Each port consists of an address and data field.</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">class</span> RegisterFile<span class="token punctuation">(</span>readPorts<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token keyword">extends</span> Module <span class="token punctuation">{</span>
    require<span class="token punctuation">(</span>readPorts <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> io <span class="token operator">=</span> IO<span class="token punctuation">(</span><span class="token keyword">new</span> Bundle <span class="token punctuation">{</span>
        <span class="token keyword">val</span> wen   <span class="token operator">=</span> Input<span class="token punctuation">(</span>Bool<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">val</span> waddr <span class="token operator">=</span> Input<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">5.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">val</span> wdata <span class="token operator">=</span> Input<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">32.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">val</span> raddr <span class="token operator">=</span> Input<span class="token punctuation">(</span>Vec<span class="token punctuation">(</span>readPorts<span class="token punctuation">,</span> UInt<span class="token punctuation">(</span><span class="token number">5.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">val</span> rdata <span class="token operator">=</span> Output<span class="token punctuation">(</span>Vec<span class="token punctuation">(</span>readPorts<span class="token punctuation">,</span> UInt<span class="token punctuation">(</span><span class="token number">32.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// A Register of a vector of UInts</span>
    <span class="token keyword">val</span> reg <span class="token operator">=</span> RegInit<span class="token punctuation">(</span>VecInit<span class="token punctuation">(</span>Seq<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0.</span>U<span class="token punctuation">(</span><span class="token number">32.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    when<span class="token punctuation">(</span>io<span class="token punctuation">.</span>wen<span class="token punctuation">)</span><span class="token punctuation">{</span>
        reg<span class="token punctuation">(</span>io<span class="token punctuation">.</span>waddr<span class="token punctuation">)</span> <span class="token operator">:</span><span class="token operator">=</span> io<span class="token punctuation">.</span>wdata
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token keyword">&lt;-</span> <span class="token number">0</span> until readPorts<span class="token punctuation">)</span><span class="token punctuation">{</span>
        when<span class="token punctuation">(</span>io<span class="token punctuation">.</span>raddr<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">==</span><span class="token operator">=</span> <span class="token number">0.</span>U<span class="token punctuation">)</span><span class="token punctuation">{</span>
            io<span class="token punctuation">.</span>rdata<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">:</span><span class="token operator">=</span> <span class="token number">0.</span>U
        <span class="token punctuation">}</span><span class="token punctuation">.</span>otherwise<span class="token punctuation">{</span>
            io<span class="token punctuation">.</span>rdata<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">:</span><span class="token operator">=</span> reg<span class="token punctuation">(</span>io<span class="token punctuation">.</span>raddr<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>readPorts</code> 表示寄存器文件的读端口数量。这个数量决定了在任何给定的时钟周期内，可以同时读取多少个独立寄存器的数据。每个读端口由其自己的读取地址（<code>raddr</code>）和读取数据（<code>rdata</code>）组成。在这种设置中，你可以在一个时钟周期内并行读取多个寄存器的值，而不是一次只能读取一个，这对于增加处理器的数据吞吐量非常有用。</p> <p>具体到代码：</p> <ul><li><code>readPorts</code>：定义了有多少个并行的读端口可用于同时读取寄存器文件中的数据。</li> <li><code>io.raddr</code>：一个向量，包含了每个读端口对应的读取地址。每个读端口都可以独立地从寄存器文件中选择一个寄存器进行读取。</li> <li><code>io.rdata</code>：一个向量，用于输出每个读端口读取到的寄存器值。每个端口根据对应的<code>raddr</code>读取寄存器文件中的数据，并将其放置在<code>rdata</code>的相应位置。</li></ul></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Blog/Chip/Chip/2024.02.21-Chisel/2024.02.21-ChiselBoot/2024.03.01-3.1 Generators Parameters.html" class="prev">
        2024.03.01-3.1 Generators: Parameters
      </a></span> <span class="next"><a href="/Blog/Chip/Chip/2024.02.21-Chisel/2024.02.21-ChiselBoot/2024.03.04-3.3 Interlude Chisel Standard Library.html">
        2024.03.04-3.3 Interlude: Chisel Standard Library
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/Blog/assets/js/app.fffc62c2.js" defer></script><script src="/Blog/assets/js/2.d9b38520.js" defer></script><script src="/Blog/assets/js/1.a4e52cf6.js" defer></script><script src="/Blog/assets/js/62.9d7660e9.js" defer></script>
  </body>
</html>
