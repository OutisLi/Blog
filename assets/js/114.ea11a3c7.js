(window.webpackJsonp=window.webpackJsonp||[]).push([[114],{475:function(v,a,t){"use strict";t.r(a);var o=t(14),_=Object(o.a)({},(function(){var v=this,a=v._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[a("h1",{attrs:{id:"_08-🎯-备份和迁移数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_08-🎯-备份和迁移数据"}},[v._v("#")]),v._v(" 08. 🎯 备份和迁移数据")]),v._v(" "),a("h3",{attrs:{id:"迁移方式介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#迁移方式介绍"}},[v._v("#")]),v._v(" 迁移方式介绍")]),v._v(" "),a("p",[v._v("容器中的数据，如果没有用挂载目录，删除容器后就会丢失数据。")]),v._v(" "),a("p",[v._v("前面我们已经讲解了如何 "),a("a",{attrs:{href:"doc:kze7f0ZR"}},[v._v("挂载目录")])]),v._v(" "),a("p",[v._v("如果你是用"),a("code",[v._v("bind mount")]),v._v("直接把宿主机的目录挂进去容器，那迁移数据很方便，直接复制目录就好了")]),v._v(" "),a("p",[v._v("如果你是用"),a("code",[v._v("volume")]),v._v("方式挂载的，由于数据是由容器创建和管理的，需要用特殊的方式把数据弄出来。")]),v._v(" "),a("blockquote",[a("p",[v._v("本文档课件配套 视频教程")])]),v._v(" "),a("h3",{attrs:{id:"备份和导入-volume-的流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#备份和导入-volume-的流程"}},[v._v("#")]),v._v(" 备份和导入 Volume 的流程")]),v._v(" "),a("p",[v._v("备份：")]),v._v(" "),a("ul",[a("li",[v._v("运行一个 ubuntu 的容器，挂载需要备份的 volume 到容器，并且挂载宿主机目录到容器里的备份目录。")]),v._v(" "),a("li",[v._v("运行 tar 命令把数据压缩为一个文件")]),v._v(" "),a("li",[v._v("把备份文件复制到需要导入的机器")])]),v._v(" "),a("p",[v._v("导入：")]),v._v(" "),a("ul",[a("li",[v._v("运行 ubuntu 容器，挂载容器的 volume，并且挂载宿主机备份文件所在目录到容器里")]),v._v(" "),a("li",[v._v("运行 tar 命令解压备份文件到指定目录")])]),v._v(" "),a("h3",{attrs:{id:"备份-mongodb-数据演示"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#备份-mongodb-数据演示"}},[v._v("#")]),v._v(" 备份 MongoDB 数据演示")]),v._v(" "),a("ul",[a("li",[a("p",[v._v("运行一个 mongodb，创建一个名叫"),a("code",[v._v("mongo-data")]),v._v("的 volume 指向容器的 /data 目录")]),v._v(" "),a("p",[a("code",[v._v("docker run -p 27018:27017 --name mongo -v mongo-data:/data -d mongo:4.4")])])]),v._v(" "),a("li",[a("p",[v._v("运行一个 Ubuntu 的容器，挂载"),a("code",[v._v("mongo")]),v._v("容器的所有 volume，映射宿主机的 backup 目录到容器里面的 /backup 目录，然后运行 tar 命令把数据压缩打包")]),v._v(" "),a("p",[a("code",[v._v("docker run --rm --volumes-from mongo -v d:/backup:/backup ubuntu tar cvf /backup/backup.tar /data/")])])])]),v._v(" "),a("p",[v._v("最后你就可以拿着这个 backup.tar 文件去其他地方导入了。")]),v._v(" "),a("h3",{attrs:{id:"恢复-volume-数据演示"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#恢复-volume-数据演示"}},[v._v("#")]),v._v(" 恢复 Volume 数据演示")]),v._v(" "),a("ul",[a("li",[v._v("运行一个 ubuntu 容器，挂载 mongo 容器的所有 volumes，然后读取 /backup 目录中的备份文件，解压到 /data/ 目录"),a("code",[v._v('docker run --rm --volumes-from mongo -v d:/backup:/backup ubuntu bash -c "cd /data/ && tar xvf /backup/backup.tar --strip 1"')])])]),v._v(" "),a("blockquote",[a("p",[v._v("注意，volumes-from 指定的是容器名字")]),v._v(" "),a("p",[v._v("strip 1 表示解压时去掉前面1层目录，因为压缩时包含了绝对路径")])]),v._v(" "),a("hr")])}),[],!1,null,null,null);a.default=_.exports}}]);