(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{367:function(a,s,t){a.exports=t.p+"assets/img/G4E.f2c635d7.jpeg"},461:function(a,s,t){"use strict";t.r(s);var e=t(14),n=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"_2023-02-13-在超算上搭建singularity环境并配置geant4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2023-02-13-在超算上搭建singularity环境并配置geant4"}},[a._v("#")]),a._v(" 2023.02.13-在超算上搭建Singularity环境并配置Geant4")]),a._v(" "),s("h2",{attrs:{id:"i-制作singularity包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#i-制作singularity包"}},[a._v("#")]),a._v(" I. 制作singularity包")]),a._v(" "),s("h3",{attrs:{id:"_1-进入fakeroot节点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-进入fakeroot节点"}},[a._v("#")]),a._v(" 1. 进入fakeroot节点")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ssh")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("user_id"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("@162.105.133.209\n")])])]),s("h3",{attrs:{id:"_2-制作并进入sandbox镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-制作并进入sandbox镜像"}},[a._v("#")]),a._v(" 2. 制作并进入sandbox镜像")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("搭建ubuntu")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("singularity build "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--fakeroot")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--sandbox")]),a._v(" Geant4 docker://ubuntu:22.04\n")])])])]),a._v(" "),s("li",[s("p",[a._v("进入Geant4环境（sandbox）")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("singularity shell "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--fakeroot")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-w")]),a._v(" Geant4\n")])])])])]),a._v(" "),s("h3",{attrs:{id:"_3-配置geant4环境"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置geant4环境"}},[a._v("#")]),a._v(" 3. 配置geant4环境")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("安装基本环境")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt-get")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" build-essential\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt-get")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v("\n")])])])]),a._v(" "),s("li",[s("p",[a._v("下载geant4")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" geant4\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://geant4-data.web.cern.ch/releases/geant4-v11.1.0.tar.gz\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-xzvf")]),a._v(" geant4-v11.1.0.tar.gz\n")])])])]),a._v(" "),s("li",[s("p",[a._v("安装依赖包（若报错，则分别单独安装）")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt-get")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" cmake libx11-dev libxext-dev libxtst-dev libxrender-dev libxmu-dev libxmuu-dev libhdf5-serial-dev hdf5-tools\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt-get")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" libexpat1-dev\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" qt5*\n")])])])]),a._v(" "),s("li",[s("p",[a._v("编译安装")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" build\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" build\ncmake "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-DCMAKE_INSTALL_PREFIX")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/root/Geant4/home/geant4 /root/Geant4/home/geant4-v11.1.0\ncmake "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-DGEANT4_INSTALL_DATA")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("ON "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("make")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-jN")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# N表示处理器数量，需修改为实际值")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("make")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v("\n")])])])]),a._v(" "),s("li",[s("p",[a._v("配置环境变量")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /root/Geant4/etc/skel/\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" .bashrc\n")])])]),s("p",[a._v("将下列内容添加到 "),s("code",[a._v(".bashrc")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("source")]),a._v(" /root/Geant4/home/geant4/bin/geant4.sh\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("source")]),a._v(" /root/Geant4/home/geant4/share/Geant4/geant4make/geant4make.sh\n")])])]),s("p",[a._v("配置")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" /root/Geant4/etc/skel/.bashrc /root/Geant4/home\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /root/Geant4/home\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("source")]),a._v(" .bashrc\n")])])])]),a._v(" "),s("li",[s("p",[a._v("检验geant4是否配置成功")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /root/Geant4/home/geant4/share/Geant4/examples/basic/B1\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" build "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" build\ncmake "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("make")]),a._v("\n./exampleB1 run1.mac\n")])])]),s("p",[a._v("若无报错则配置成功")])]),a._v(" "),s("li",[s("p",[a._v("退出")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exit")]),a._v("\n")])])])])]),a._v(" "),s("h3",{attrs:{id:"_4-打包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-打包"}},[a._v("#")]),a._v(" 4. 打包")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("singularity build "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--fakeroot")]),a._v(" s-Geant4.sif Geant4/\n")])])]),s("hr"),a._v(" "),s("h2",{attrs:{id:"ii-配置go-singularity"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ii-配置go-singularity"}},[a._v("#")]),a._v(" II. 配置go&singularity")]),a._v(" "),s("h3",{attrs:{id:"_1-配置go环境"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-配置go环境"}},[a._v("#")]),a._v(" 1. 配置go环境")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 超算Data节点")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("VERSION")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1.17")]),a._v(".2 "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("OS")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("linux "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("ARCH")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("amd64\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://dl.google.com/go/go"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$VERSION")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$OS")]),a._v("-"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$ARCH")]),a._v(".tar.gz\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-xzvf")]),a._v(" go1.17.2.linux-amd64.tar.gz\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" go1.17.2.linux-amd64.tar.gz\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("PATH")])]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/lustre/home/"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("user_id"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("/go/bin:"),s("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("$PATH")]),a._v("\n")])])]),s("h3",{attrs:{id:"_2-安装singularity"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装singularity"}},[a._v("#")]),a._v(" 2. 安装singularity")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("module load singularity/3.11.3\n")])])]),s("h3",{attrs:{id:"_3-环境变量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-环境变量"}},[a._v("#")]),a._v(" 3. 环境变量")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("$HOME")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" .bashrc\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 将下列语句添加到.bashrc中")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# export PATH=/lustre/home/<user_id>/go/bin:$PATH")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("source")]),a._v(" .bashrc\n")])])]),s("hr"),a._v(" "),s("h2",{attrs:{id:"iii-启用singularity"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#iii-启用singularity"}},[a._v("#")]),a._v(" III. 启用singularity")]),a._v(" "),s("h3",{attrs:{id:"_1-将sif镜像下载到常规节点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-将sif镜像下载到常规节点"}},[a._v("#")]),a._v(" 1. 将SIF镜像下载到常规节点")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("scp")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("user_id"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("@162.105.133.209:/home/"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("user_id"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("/s-Geant4.sif /gpfs/share/home/"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("user_id"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("/\n")])])]),s("h3",{attrs:{id:"_2-转换成sandbox镜像并启用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-转换成sandbox镜像并启用"}},[a._v("#")]),a._v(" 2. 转换成sandbox镜像并启用")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("singularity build "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--sandbox")]),a._v(" Geant4 s-Geant4.sif\nsingularity shell "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-w")]),a._v(" Geant4\n")])])]),s("h3",{attrs:{id:"_3-配置环境变量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置环境变量"}},[a._v("#")]),a._v(" 3. 配置环境变量")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" Geant4/home\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" .bashrc\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 将下列语句添加到文件末尾")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# source /lustre/home/2201210084/singularity/Geant4/home/geant4/bin/geant4.sh")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# source /lustre/home/2201210084/singularity/Geant4/home/geant4/share/Geant4/geant4make/geant4make.sh")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("source")]),a._v(" .bashrc\n")])])]),s("p",[a._v("看见如下字样表示成功")]),a._v(" "),s("p",[s("img",{attrs:{src:t(367),alt:"Untitled"}})]),a._v(" "),s("h2",{attrs:{id:"iv-附录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#iv-附录"}},[a._v("#")]),a._v(" IV. 附录")]),a._v(" "),s("h3",{attrs:{id:"_1-sif容器与sandbox相互转换"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-sif容器与sandbox相互转换"}},[a._v("#")]),a._v(" 1. SIF容器与sandbox相互转换")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 1. 将SIF格式的容器转换成sandbox;")]),a._v("\nsingularity build "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--sandbox")]),a._v(" XXX XXX.sif\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 2. 将sandbox容器镜像转化成SIF格式;")]),a._v("\nsingularity build XXX.sif XXX\n")])])]),s("h3",{attrs:{id:"_2-在fakeroot节点上删除sandbox镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-在fakeroot节点上删除sandbox镜像"}},[a._v("#")]),a._v(" 2. 在fakeroot节点上删除sandbox镜像")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 假设要删除的为文件夹名为molspin的sandbox镜像")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 首先，以可读的模式进入要删除的镜像")]),a._v("\nsingularity shell "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--fakeroot")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-w")]),a._v(" molspin\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 删除掉容器中，基于fakeroot创建的所有文件")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-rf")]),a._v(" /* "),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("1")]),a._v(">")]),a._v("/dev/null "),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("2")]),a._v(">")]),s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("&1")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 退出镜像")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exit")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 将创建好的软件镜像上传到高性能计算集群，加载singularity软件环境")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 删除掉剩下的")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-rf")]),a._v(" molspin\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);