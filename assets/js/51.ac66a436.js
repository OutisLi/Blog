(window.webpackJsonp=window.webpackJsonp||[]).push([[51],{376:function(a,s,t){a.exports=t.p+"assets/img/1212.4aca9893.png"},478:function(a,s,t){"use strict";t.r(s);var e=t(14),r=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"_2023-12-12-制作定制镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2023-12-12-制作定制镜像"}},[a._v("#")]),a._v(" 2023.12.12-制作定制镜像")]),a._v(" "),s("h2",{attrs:{id:"_1-获取ubuntu系统"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-获取ubuntu系统"}},[a._v("#")]),a._v(" 1. 获取Ubuntu系统")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" ubuntu:22.04 /bin/bash\n")])])]),s("p",[s("img",{attrs:{src:t(376),alt:"Untitled"}})]),a._v(" "),s("h2",{attrs:{id:"_2-在容器内配置容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-在容器内配置容器"}},[a._v("#")]),a._v(" 2. 在容器内配置容器")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt-get")]),a._v(" update "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt-get")]),a._v(" upgrade\n")])])]),s("h2",{attrs:{id:"_3-将容器打包成镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-将容器打包成镜像"}},[a._v("#")]),a._v(" 3. 将容器打包成镜像")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" commit "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"geant4 installed"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"OutisPKU"')]),a._v(" f87240cdb380 outispku/geant4:v1\n")])])]),s("h2",{attrs:{id:"_4-将镜像实例化为容器并运行终端"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-将镜像实例化为容器并运行终端"}},[a._v("#")]),a._v(" 4. 将镜像实例化为容器并运行终端")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" D:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("BaiduSyncdisk"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Postgraduate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Research"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Geant4"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Project:/home "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" geant4_test outispku/geant4:v1 /bin/bash\n")])])]),s("p",[a._v("其中"),s("code",[a._v("-v D:\\BaiduSyncdisk\\Postgraduate\\Research\\Geant4\\Project:/home")]),a._v("为将主机的目录映射到容器中")]),a._v(" "),s("h1",{attrs:{id:"使用dockerfile创建镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用dockerfile创建镜像"}},[a._v("#")]),a._v(" 使用Dockerfile创建镜像")]),a._v(" "),s("h2",{attrs:{id:"_1-编写容器启动脚本start-sh"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-编写容器启动脚本start-sh"}},[a._v("#")]),a._v(" 1. 编写容器启动脚本"),s("code",[a._v("start.sh")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token shebang important"}},[a._v("#!/bin/bash")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Source Geant4 environment scripts")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("source")]),a._v(" /geant4/bin/geant4.sh\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("source")]),a._v(" /geant4/share/Geant4/geant4make/geant4make.sh\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 获取系统的线程数")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("NUM_THREADS")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("expr")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("$(")]),a._v("nproc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" - "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /program\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 构建命令")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("CMD_TO_ADD")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/run/numberOfThreads '),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$NUM_THREADS")]),a._v('"')]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 将命令添加到 run.mac 的第一行")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sed")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"1i '),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$CMD_TO_ADD")]),a._v('"')]),a._v(" ./run.mac\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 定义目录路径")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("BUILD_DIR")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/program/build"')]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 检查目录是否存在")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$BUILD_DIR")]),a._v('"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("then")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 如果目录存在，删除它")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-rf")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$BUILD_DIR")]),a._v('"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("fi")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建新的目录")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$BUILD_DIR")]),a._v('"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" build\ncmake "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("make")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$NUM_THREADS")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# PKU_Trim_Geant4 为程序名称（可执行文件），由CMakeLists.txt中的add_executable(PKU_Trim_Geant4 PKU_Trim_Geant4.cc)决定")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用前请修改")]),a._v("\n./PKU_Trim_Geant4 run.mac "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" /dev/null "),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("2")]),a._v(">>")]),a._v("error.txt\n")])])]),s("h2",{attrs:{id:"_2-编写dockerfile"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-编写dockerfile"}},[a._v("#")]),a._v(" 2. 编写"),s("code",[a._v("Dockerfile")])]),a._v(" "),s("div",{staticClass:"language-docker extra-class"},[s("pre",{pre:!0,attrs:{class:"language-docker"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 原单Geant4镜像")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("FROM")]),a._v(" outispku/geant4:v1")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 指定启动脚本")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("COPY")]),a._v(" start.sh /")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("RUN")]),a._v(" chmod +x /start.sh")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("RUN")]),a._v(" mkdir program")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("ENTRYPOINT")]),a._v(" ["),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/start.sh"')]),a._v("]")]),a._v("\n")])])]),s("h2",{attrs:{id:"_3-构建镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-构建镜像"}},[a._v("#")]),a._v(" 3. 构建镜像")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" build "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" outispku/geant4:v2 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v("\n")])])]),s("h2",{attrs:{id:"_4-运行容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-运行容器"}},[a._v("#")]),a._v(" 4. 运行容器")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" D:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("FinFET:/program "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" geant4_program outispku/geant4:v2\n")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);