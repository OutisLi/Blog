# 03. ğŸ’½ åˆ¶ä½œè‡ªå·±çš„é•œåƒ

### ä¸ºè‡ªå·±çš„ Web é¡¹ç›®æ„å»ºé•œåƒ

ç¤ºä¾‹é¡¹ç›®ä»£ç ï¼š[https://github.com/gzyunke/test-docker](https://github.com/gzyunke/test-docker)

è¿™æ˜¯ä¸€ä¸ª Nodejs + Koa2 å†™çš„ Web é¡¹ç›®ï¼Œæä¾›äº†ç®€å•çš„ä¸¤ä¸ªæ¼”ç¤ºé¡µé¢ã€‚

è½¯ä»¶ä¾èµ–ï¼š[nodejs](https://nodejs.org/zh-cn/)

é¡¹ç›®ä¾èµ–åº“ï¼škoaã€log4jsã€koa-router

> æœ¬æ–‡æ¡£è¯¾ä»¶é…å¥— è§†é¢‘æ•™ç¨‹
> 

### ç¼–å†™ Dockerfile

```
FROM node:11
MAINTAINER easydoc.net

# å¤åˆ¶ä»£ç 
ADD . /app

# è®¾ç½®å®¹å™¨å¯åŠ¨åçš„é»˜è®¤è¿è¡Œç›®å½•
WORKDIR /app

# è¿è¡Œå‘½ä»¤ï¼Œå®‰è£…ä¾èµ–
# RUN å‘½ä»¤å¯ä»¥æœ‰å¤šä¸ªï¼Œä½†æ˜¯å¯ä»¥ç”¨ && è¿æ¥å¤šä¸ªå‘½ä»¤æ¥å‡å°‘å±‚çº§ã€‚
# ä¾‹å¦‚ RUN npm install && cd /app && mkdir logs
RUN npm install --registry=https://registry.npm.taobao.org

# CMD æŒ‡ä»¤åªèƒ½ä¸€ä¸ªï¼Œæ˜¯å®¹å™¨å¯åŠ¨åæ‰§è¡Œçš„å‘½ä»¤ï¼Œç®—æ˜¯ç¨‹åºçš„å…¥å£ã€‚
# å¦‚æœè¿˜éœ€è¦è¿è¡Œå…¶ä»–å‘½ä»¤å¯ä»¥ç”¨ && è¿æ¥ï¼Œä¹Ÿå¯ä»¥å†™æˆä¸€ä¸ªshellè„šæœ¬å»æ‰§è¡Œã€‚
# ä¾‹å¦‚ CMD cd /app && ./start.sh
CMD node app.js
```

[Dockerfileæ–‡æ¡£](https://docs.docker.com/engine/reference/builder/#run)

> å®ç”¨æŠ€å·§ï¼š
> 
> 
> å¦‚æœä½ å†™ Dockerfile æ—¶ç»å¸¸é‡åˆ°ä¸€äº›è¿è¡Œé”™è¯¯ï¼Œä¾èµ–é”™è¯¯ç­‰ï¼Œä½ å¯ä»¥ç›´æ¥è¿è¡Œä¸€ä¸ªä¾èµ–çš„åº•ï¼Œç„¶åè¿›å…¥ç»ˆç«¯è¿›è¡Œé…ç½®ç¯å¢ƒï¼ŒæˆåŠŸåå†æŠŠåšè¿‡çš„æ­¥éª¤å‘½ä»¤å†™é“ Dockerfile æ–‡ä»¶ä¸­ï¼Œè¿™æ ·ç¼–å†™è°ƒè¯•ä¼šå¿«å¾ˆå¤šã€‚
> 
> ä¾‹å¦‚ä¸Šé¢çš„åº•æ˜¯`node:11`ï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œ`docker run -it -d node:11 bash`ï¼Œè·‘èµ·æ¥åè¿›å…¥å®¹å™¨ç»ˆç«¯é…ç½®ä¾èµ–çš„è½¯ä»¶ï¼Œç„¶åå°è¯•è·‘èµ·æ¥è‡ªå·±çš„è½¯ä»¶ï¼Œæœ€åæŠŠæ‰€æœ‰åšè¿‡çš„æ­¥éª¤å†™å…¥åˆ° Dockerfile å°±å¥½äº†ã€‚
> 
> æŒæ¡å¥½è¿™ä¸ªæŠ€å·§ï¼Œä½ çš„ Dockerfile æ–‡ä»¶ç¼–å†™èµ·æ¥å°±éå¸¸çš„å¾—å¿ƒåº”æ‰‹äº†ã€‚
> 

### Build ä¸ºé•œåƒï¼ˆå®‰è£…åŒ…ï¼‰å’Œè¿è¡Œ

ç¼–è¯‘ `docker build -t test:v1 .`

> -t è®¾ç½®é•œåƒåå­—å’Œç‰ˆæœ¬å·
> 
> 
> å‘½ä»¤å‚è€ƒï¼š[https://docs.docker.com/engine/reference/commandline/build/](https://docs.docker.com/engine/reference/commandline/build/)
> 

è¿è¡Œ `docker run -p 8080:8080 --name test-hello test:v1`

> -p æ˜ å°„å®¹å™¨å†…ç«¯å£åˆ°å®¿ä¸»æœº
> 
> - `-name` å®¹å™¨åå­—
> - `d` åå°è¿è¡Œ
> 
> å‘½ä»¤å‚è€ƒæ–‡æ¡£ï¼š[https://docs.docker.com/engine/reference/run/](https://docs.docker.com/engine/reference/run/)
> 

### æ›´å¤šç›¸å…³å‘½ä»¤

`docker ps` æŸ¥çœ‹å½“å‰è¿è¡Œä¸­çš„å®¹å™¨

`docker images` æŸ¥çœ‹é•œåƒåˆ—è¡¨

`docker rm container-id` åˆ é™¤æŒ‡å®š id çš„å®¹å™¨

`docker stop/start container-id` åœæ­¢/å¯åŠ¨æŒ‡å®š id çš„å®¹å™¨

`docker rmi image-id` åˆ é™¤æŒ‡å®š id çš„é•œåƒ

`docker volume ls` æŸ¥çœ‹ volume åˆ—è¡¨

`docker network ls` æŸ¥çœ‹ç½‘ç»œåˆ—è¡¨