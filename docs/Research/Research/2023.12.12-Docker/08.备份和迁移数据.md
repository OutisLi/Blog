# 08. ðŸŽ¯ å¤‡ä»½å’Œè¿ç§»æ•°æ®

### è¿ç§»æ–¹å¼ä»‹ç»

å®¹å™¨ä¸­çš„æ•°æ®ï¼Œå¦‚æžœæ²¡æœ‰ç”¨æŒ‚è½½ç›®å½•ï¼Œåˆ é™¤å®¹å™¨åŽå°±ä¼šä¸¢å¤±æ•°æ®ã€‚

å‰é¢æˆ‘ä»¬å·²ç»è®²è§£äº†å¦‚ä½• [æŒ‚è½½ç›®å½•](doc:kze7f0ZR)

å¦‚æžœä½ æ˜¯ç”¨`bind mount`ç›´æŽ¥æŠŠå®¿ä¸»æœºçš„ç›®å½•æŒ‚è¿›åŽ»å®¹å™¨ï¼Œé‚£è¿ç§»æ•°æ®å¾ˆæ–¹ä¾¿ï¼Œç›´æŽ¥å¤åˆ¶ç›®å½•å°±å¥½äº†

å¦‚æžœä½ æ˜¯ç”¨`volume`æ–¹å¼æŒ‚è½½çš„ï¼Œç”±äºŽæ•°æ®æ˜¯ç”±å®¹å™¨åˆ›å»ºå’Œç®¡ç†çš„ï¼Œéœ€è¦ç”¨ç‰¹æ®Šçš„æ–¹å¼æŠŠæ•°æ®å¼„å‡ºæ¥ã€‚

> æœ¬æ–‡æ¡£è¯¾ä»¶é…å¥— è§†é¢‘æ•™ç¨‹
> 

### å¤‡ä»½å’Œå¯¼å…¥ Volume çš„æµç¨‹

å¤‡ä»½ï¼š

- è¿è¡Œä¸€ä¸ª ubuntu çš„å®¹å™¨ï¼ŒæŒ‚è½½éœ€è¦å¤‡ä»½çš„ volume åˆ°å®¹å™¨ï¼Œå¹¶ä¸”æŒ‚è½½å®¿ä¸»æœºç›®å½•åˆ°å®¹å™¨é‡Œçš„å¤‡ä»½ç›®å½•ã€‚
- è¿è¡Œ tar å‘½ä»¤æŠŠæ•°æ®åŽ‹ç¼©ä¸ºä¸€ä¸ªæ–‡ä»¶
- æŠŠå¤‡ä»½æ–‡ä»¶å¤åˆ¶åˆ°éœ€è¦å¯¼å…¥çš„æœºå™¨

å¯¼å…¥ï¼š

- è¿è¡Œ ubuntu å®¹å™¨ï¼ŒæŒ‚è½½å®¹å™¨çš„ volumeï¼Œå¹¶ä¸”æŒ‚è½½å®¿ä¸»æœºå¤‡ä»½æ–‡ä»¶æ‰€åœ¨ç›®å½•åˆ°å®¹å™¨é‡Œ
- è¿è¡Œ tar å‘½ä»¤è§£åŽ‹å¤‡ä»½æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•

### å¤‡ä»½ MongoDB æ•°æ®æ¼”ç¤º

- è¿è¡Œä¸€ä¸ª mongodbï¼Œåˆ›å»ºä¸€ä¸ªåå«`mongo-data`çš„ volume æŒ‡å‘å®¹å™¨çš„ /data ç›®å½•
    
    `docker run -p 27018:27017 --name mongo -v mongo-data:/data -d mongo:4.4`
    
- è¿è¡Œä¸€ä¸ª Ubuntu çš„å®¹å™¨ï¼ŒæŒ‚è½½`mongo`å®¹å™¨çš„æ‰€æœ‰ volumeï¼Œæ˜ å°„å®¿ä¸»æœºçš„ backup ç›®å½•åˆ°å®¹å™¨é‡Œé¢çš„ /backup ç›®å½•ï¼Œç„¶åŽè¿è¡Œ tar å‘½ä»¤æŠŠæ•°æ®åŽ‹ç¼©æ‰“åŒ…
    
    `docker run --rm --volumes-from mongo -v d:/backup:/backup ubuntu tar cvf /backup/backup.tar /data/`
    

æœ€åŽä½ å°±å¯ä»¥æ‹¿ç€è¿™ä¸ª backup.tar æ–‡ä»¶åŽ»å…¶ä»–åœ°æ–¹å¯¼å…¥äº†ã€‚

### æ¢å¤ Volume æ•°æ®æ¼”ç¤º

- è¿è¡Œä¸€ä¸ª ubuntu å®¹å™¨ï¼ŒæŒ‚è½½ mongo å®¹å™¨çš„æ‰€æœ‰ volumesï¼Œç„¶åŽè¯»å– /backup ç›®å½•ä¸­çš„å¤‡ä»½æ–‡ä»¶ï¼Œè§£åŽ‹åˆ° /data/ ç›®å½•`docker run --rm --volumes-from mongo -v d:/backup:/backup ubuntu bash -c "cd /data/ && tar xvf /backup/backup.tar --strip 1"`

> æ³¨æ„ï¼Œvolumes-from æŒ‡å®šçš„æ˜¯å®¹å™¨åå­—
> 
> 
> strip 1 è¡¨ç¤ºè§£åŽ‹æ—¶åŽ»æŽ‰å‰é¢1å±‚ç›®å½•ï¼Œå› ä¸ºåŽ‹ç¼©æ—¶åŒ…å«äº†ç»å¯¹è·¯å¾„
> 

---